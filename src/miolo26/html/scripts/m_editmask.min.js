dojo.declare("Miolo.editMask",null,{version:"0.1",h1:null,h2:null,h3:null,h4:null,constructor:function(e,t,i,r){if(this.element=miolo.getElementById(e),null!=this.element){this.mask=t,this.errMsg=""!=r?r:"Caracter invÃ¡lido!",this.optional=i;var s=this.element.value?this.filterStrip(this.element.value):"";this.element.value=this.fillMask(s),this.fcolor=""==this.element.style.color?"black":e.style.color,this.first=!0,this.element.editMask=this,this.h1=dojo.connect(this.element,"keypress",this,this.process),this.h2=dojo.connect(this.element,"focus",this,this.onEnter),this.h3=dojo.connect(this.element,"submit",this,this.onSubmit)}},onEnter:function(e){element=e.target,element.editMask.color=element.style.color,element.editMask.first=!0;var t=element.value?element.editMask.filterStrip(element.value):"";element.value=element.editMask.fillMask(t)},onExit:function(e){element=e.target;var t=element.editMask.canBlur(element);return t?(dojo.disconnect(element.editMask.h4),element.editMask.first=!0):element.focus(),t},canBlur:function(e){var t=e.editMask.filterExit(e.value),i=!0;return e.editMask.optional||(i=t.length==e.editMask.mask.length),i?(e.value=t,e.style.color=e.editMask.fcolor):(e.style.color="red",e.focus()),i},onError:function(e){alert(e)},onSubmit:function(){return this.element.value=this.filterExit(this.element.value),!0},process:function(e){element=e.target,keyCode=0!=e.charCode?e.charCode:e.keyCode,editMask=element.editMask,element.editMask.first&&(element.editMask.h4=dojo.connect(element,"blur",element.editMask,element.editMask.onExit),element.editMask.first=!1),filter=editMask.filterStrip(element.value);var t="";if(9==keyCode)return!0;8==keyCode&&0!=filter.length?filter=filter.substring(0,filter.length-1):t=keyCode>47&&122>keyCode&&filter.length<editMask.filterMax()?filter+String.fromCharCode(keyCode):filter;var i="",r=editMask.validateMask(t);return i=editMask.fillMask(r?r:filter),element.value=i,e.preventDefault(),!1},filterStrip:function(e){mask=this.mask;for(var t=0;t<mask.length++;t++){var i=mask.charAt(t);this.isEditChar(i)&&(mask=this.filterReplace(mask,mask.substring(t,t+1),""))}filterMask=mask+"_";for(var t=0;t<filterMask.length++;t++)e=this.filterReplace(e,filterMask.substring(t,t+1),"");return e},filterMask:function(e){filterMask="_";for(var t=0;t<filterMask.length++;t++)e=this.filterReplace(e,filterMask.substring(t,t+1),"");return e},filterMax:function(){filterTemp=this.mask;for(var e=0;e<this.mask.length+1;e++){var t=this.mask.charAt(e);this.isEditChar(t)||(filterTemp=this.filterReplace(filterTemp,t,""))}return filterTemp.length},filterExit:function(e){for(mask=this.mask+"_";e.length>0&&mask.indexOf(e.charAt(0))>-1;)e=e.substr(1);return e},filterReplace:function(e,t,i){var r=e.length,s=t.length;if(0==r||0==s)return e;var n=e.indexOf(t);if(!n&&t!=e.substring(0,s))return e;if(-1==n)return e;var l=e.substring(0,n)+i;return r>n+s&&(l+=this.filterReplace(e.substring(n+s,r),t,i)),l},isEditChar:function(e){switch(e){case"_":case"#":case"a":case"A":case"l":case"L":return!0;default:return!1}return!1},displayMaskChar:function(e){return this.isEditChar(e)?"_":e},displayMask:function(e){for(var t="",i=0;i<e.length;i++)t+=this.displayMaskChar(e.substr(i,1));return t},validateMask:function(e){for(var t=!0,i=this.mask.length-1,r=posmask=0,s=e.length-1,n="";s>=r&&i>=posmask;){var l=this.mask.charAt(posmask),a=e.charCodeAt(r);if(this.isEditChar(l)){var h=this.isInsertOK(a,l);(t=t&&null!=h)?n+=String.fromCharCode(h):this.onError(this.errMsg),r+=1}posmask+=1}return t?n:null},fillMask:function(e){for(var t="",i=e.length-1,r=this.mask.length-1,s=i,n=r;n>=0;){var l=this.mask.charAt(n);if(s>=0){var a=e.charAt(s);this.isEditChar(l)?(t=a+t,s-=1):t=l+t}else t=this.isEditChar(l)?"_"+t:l+t;n-=1}return t},isInsertOK:function(e,t){switch(t){case"_":return!0;case"#":return this.checkDigit(e);case"a":return this.checkAlphaNumeric(e);case"A":return this.checkUpCaseAlphaNumeric(e);case"l":return this.checkAlpha(e);case"L":return this.checkUpCaseAlpha(e)}return!1},checkDigit:function(e){return e>=48&&57>=e?e:null},checkAlpha:function(e){return e>=65&&90>=e||e>=97&&122>=e?e:null},checkUpCaseAlpha:function(e){return e>=65&&90>=e?e:e>=97&&122>=e?e-32:null},checkAlphaNumeric:function(e){return e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e?e:null},checkUpCaseAlphaNumeric:function(e){return e>=65&&90>=e?e:e>=97&&122>=e?e-32:e>=48&&57>=e?e:null}});