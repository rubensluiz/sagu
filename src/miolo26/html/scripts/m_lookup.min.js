dojo.declare("Miolo.Lookup",null,{context:null,url:"",constructor:function(){},setContext:function(e){this.context=e},start:function(e){var t=miolo.getElementById(this.context.field);if(this.url="index.php?module="+this.context.baseModule+"&action=lookup&name="+miolo.urlencode(this.context.name)+"&lmodule="+miolo.urlencode(this.context.module)+"&item="+miolo.urlencode(this.context.item)+"&event="+miolo.urlencode(this.context.event)+"&related="+miolo.urlencode(this.context.related)+"&title="+miolo.urlencode(this.context.title)+"&wtype="+miolo.urlencode(this.context.wtype),null!=t&&(this.url=this.url+"&fvalue="+miolo.urlencode(this.context.value)),null!=this.context.filter){var l=this.context.filter.split(","),o=this.context.idxFilter.split(",");if(useIdx=0!=o[0].charAt(0),1!=l.length||useIdx){for(var i=0;i<l.length;i++){t=miolo.getElementById(l[i]);var n=useIdx?o[i]:"filter"+i;this.url+="&"+n+"="+miolo.urlencode(t.value)}this.url+="&idxFilter="+this.context.idxFilter,e&&(t=miolo.getElementById(this.context.field),this.url+="&filter="+miolo.urlencode(t.value))}else e||(t=miolo.getElementById(l[0])),this.url=this.url+"&filter="+miolo.urlencode(t.value)}e?(this.url+="&autocomplete=1",this.autocomplete()):(this.url+="&autocomplete=0",this.open())},open:function(){miolo.addWindow(this.context.name),miolo.getWindow(this.context.name).setHref(this.url),miolo.getWindow(this.context.name).open()},autocomplete:function(){var ajaxAutoComplete=new Miolo.Ajax({url:this.url,response_type:"TEXT",parameters:{name:this.context.name,__ISAJAXCALL:"yes"},callback_function:function(result,ioArgs){var args=result,name=ioArgs.args.content.name,lookup=eval(name);lookup.deliver(name,0,args)}});ajaxAutoComplete.call()},deliver:function(name,key,args){var lookup=eval(name),context=lookup.context;args&&(args=args.split("|"));var event=context.event;related=context.related;for(var aRelated=related.split(","),count=aRelated.length,i=0;count>i;i++){var value="";args&&(value=miolo.urldecode(args[i]));var field=context.form["frm_"+aRelated[i]];null==field&&(field=miolo.getElementById(aRelated[i])),null!=field&&(field.value=value?value:"",field=miolo.getElementById(field.name+"_sel"),null!=field&&(field.value=value))}if(""!=event&&"filler"!=event){var ajaxArguments=null;args&&(ajaxArguments=args[key]),miolo.doAjax(event,ajaxArguments,this.context.form)}miolo.getWindow(this.context.name)&&miolo.getWindow(this.context.name).close()}});