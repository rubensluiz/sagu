alertarErroAjax=!1,dojo.require("dojo.io.script"),dojo.declare("Miolo.Page",null,{version:"0.1",scripts:new Miolo.Hash,controls:new Miolo.Hash,tokenId:"",ajaxEvent:"no",fileUpload:"no",themeLayout:"default",constructor:function(){this.obj=this},getContent:function(){return{__FORMSUBMIT:miolo.webForm?miolo.webForm.id:"",__ISAJAXCALL:"yes",__THEMELAYOUT:miolo.page.themeLayout,__MIOLOTOKENID:miolo.page.tokenId,__ISFILEUPLOAD:miolo.page.fileUpload,__ISAJAXEVENT:miolo.page.ajaxEvent}},handler:function(e){this.themeLayout="default",this.fileUpload="no";var o=new Miolo.Ajax({url:e,response_type:"JSON",parameters:miolo.page.getContent(),callback_function:function(e){miolo.page.evalresult(e)}});o.call()},ajax:function(){if(this.setValidators(!1),miolo.webForm.onSubmit()){this.setValidators(!0),this.ajaxEvent="yes",this.themeLayout="dynamic",this.fileUpload="no";var e=new Miolo.Ajax({form:"frm_"+miolo.webForm.id,content:miolo.page.getContent(),response_type:"JSON",callback_function:function(e){alertarErroAjax&&null==e&&alert("Ops! Houve algum problema de conexÃ£o com o servidor. Por favor, tente mais tarde."),miolo.page.evalresult(e)}});e.call()}},postback:function(){this.themeLayout="dynamic";var e=miolo.getElementById("__ISFILEUPLOADPOST");this.fileUpload=e?e.value:this.fileUpload;var o=new Miolo.Ajax({form:"frm_"+miolo.webForm.id,content:miolo.page.getContent(),response_type:"JSON",callback_function:function(e){miolo.page.evalresult(e)}});o.call()},getWindow:function(e,o,t){this.themeLayout="window",this.fileUpload="no";var i=new Miolo.Ajax({url:t,response_type:"JSON",parameters:miolo.page.getContent(),callback_function:function(e){var o=miolo.webForm.id;miolo.page.evalresult(e,o)}});i.call()},setValidators:function(e){miolo.webForm.validators&&(miolo.webForm.validators.on=e)},clearelement:function(e){if(e&&e.hasChildNodes())for(;e.childNodes.length>=1;)e.removeChild(e.firstChild)},includejs:function(e){for(var o=new Miolo.md5,t=/src=\"(.*)\"/gm;f=t.exec(e);){var i=o.MD5(f[1]);this.scripts.get(i)||(dojo.xhrGet({url:f[1],handleAs:"javascript",sync:!0}),this.scripts.set(i,f[1]))}},includeexternaljs:function(e,o,t){var i=new Miolo.md5,n=i.MD5(e);o||(o=function(){}),t&&this.scripts.get(n)||(dojo.io.script.get({url:e,load:o}),this.scripts.set(n,e))},evalresult:function(e,o){if(e){var t=e.data;miolo.page.evalresponse(t,o)}else miolo.page.tokenId=""},evalelement:function(e){if(e.html)for(i=0;i<e.html.length;i++){e.html[i]=e.html[i].replace(/<--ta-->/g,"</textarea>");var o=dijit.byId(e.element[i]);if(o)try{dojo.forEach(o.getChildren(),function(e){e.destroyRecursive()}),o&&"function"==typeof o.setContent?o.setContent(e.html[i]):"function"==typeof o.set&&o.set("content",e.html[i])}catch(t){}else(o=miolo.getElementById(e.element[i]))&&(this.clearelement(o),o.innerHTML=e.html[i])}},evalresponse:function(e,o){var t=e.scripts[4];""!=t?(miolo.page.stdout(t),miolo.page.tokenId=""):(""!=e.scripts[0]&&miolo.page.includejs(e.scripts[0]),this.evaljs(e.scripts[1]),this.evalelement(e),o&&dijit.byId(o).show(),e.form&&miolo.page.onload(e))},onload:function(e){var o=e.form,t='<script type="text/javascript">\nmiolo.addForm( \''+o+"');\n miolo.getForm( '"+o+"').onLoad = function() { "+e.scripts[2]+"};\nmiolo.getForm( '"+o+"').onSubmit = function() { "+e.scripts[3]+"};\nmiolo.setForm( '"+o+"');\nmiolo.getForm( '"+o+"').onLoad();\n</script>",i=dijit.byId(o+"__scripts");"function"==typeof i.setContent?i.setContent(t):i.set("content",t)},evaljs:function(e){""!=e&&dojo.eval(e)},stdout:function(e){var o=miolo.getElementById("stdout");o.innerHTML+="<br>"+e},setDynamicStyle:function(e){var o=miolo.getElementById("mPageDynamicStyle");o&&document.getElementsByTagName("head")[0].removeChild(o),o=document.createElement("style"),o.type="text/css",o.id="mPageDynamicStyle",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(o)}}),miolo.page=new Miolo.Page;