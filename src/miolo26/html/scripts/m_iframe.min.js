dojo.declare("Miolo.Iframe",null,{constructor:function(e,t,i,n,s){this.id=e,this.top=n,this.left=s,this.height=0,this.width=0,this.url=t,this.modal=i,this.status="",this.allowDragOffScreen=!1,this.raiseSelectedIframe=!0,this.highestZIndex=250,this.handles=new Array,this.reload=!1,this.base=null,this.dragElement=""},modalOn:function(){var e=xGetElementById("m-dialog-modal");if(!e){e=this.base.document.createElement("div"),e.id="m-dialog-modal",this.base.document.body.appendChild(e);var t=xClientHeight(),i=xClientWidth(),n=this.base.document.documentElement,s=parseInt(n.scrollTop,10),o=parseInt(n.scrollLeft,10);e.style.height=t+"px",e.style.width=i+"px",e.style.top=s+"px",e.style.left=o+"px"}e.style.display="block"},modalOff:function(){var e=xGetElementById("m-dialog-modal");e.style.display="none"},cursorWaitOn:function(){xWalkTree(this.container,function(e){e.style.cursor="wait"})},cursorWaitOff:function(){xWalkTree(this.container,function(e){e.style.cursor="auto"})},getInnerWindow:function(){return this.base.frames[this.id]},getDocument:function(){return iframe=this.iframe,d=null!=iframe.contentDocument?iframe.contentDocument:null!=iframe.contentWindow?iframe.contentWindow.document:null!=iframe.document?iframe.document:null},getField:function(e){return this.getDocument().getElementById(e)},setPosition:function(e,t){xMoveTo(this.iframe,t,e)},show:function(){xZIndex(this.iframe,this.modal?201:this.iframe.style.zIndex),xResizeTo(this.iframe,this.width,this.height)},hide:function(){xResizeTo(this.iframe,0,0)},open:function(){if(this.modal&&this.modalOn(),e=xGetElementById(this.id))this.reload&&(d=this.getDocument(),d.location.href=this.url),this.show(),this.status="opened";else{this.container=this.base.document.getElementById("m-container");var e=this.base.document.createElement("iframe");e.id=this.id,e.name=this.id,e.src=this.url,this.width=parseInt(.7*xWidth(this.container)),e.style.width=this.width+"px";var t=0!=this.top?this.top:xTop(this.container)+50,i=0!=this.left?this.left:xLeft(this.container)+50;e.setAttribute("frameBorder","0"),e.setAttribute("scrolling","none"),e.setAttribute("name",this.id),e.className="m-dialog-iframe",xMoveTo(e,i,t),this.base.document.body.appendChild(e),this.iframe=e,e.style.height="0px"}},parentField:function(e,t){return null==t?xGetElementById(e).value:void(xGetElementById(e).value=t)},onload:function(){this.status="opened";var p=this.getField("m-container-content-popup");iframe.style.height=xHeight(p)+"px",this.height=xHeight(p),this.enableDrag(this.getField(this.dragElement)),this.show();var cmd=this.getField("dialogCommands");""!=cmd.value&&eval(cmd.value)},close:function(){this.hide(),xZIndex(this.iframe,0),this.modal&&this.modalOff(),this.status="closed"},free:function(){this.hide(),this.modal&&this.modalOff(),this.status="closed",miolo.iFrame.dialogs[this.id]=null,this.base.document.body.removeChild(miolo.getElementById(this.id))},enableDrag:function(e){var t=(this.getInnerWindow(),this.getDocument());onMouseDownHandler=miolo.associateObjWithEvent(this,"onMouseDownHandler"),onMouseUpHandler=miolo.associateObjWithEvent(this,"onMouseUpHandler"),onMouseMoveHandler=miolo.associateObjWithEvent(this,"onMouseMoveHandler"),xAddEventListener(t,"mousedown",onMouseDownHandler,!1),xAddEventListener(t,"mouseup",onMouseUpHandler,!1),xAddEventListener(t,"mousemove",onMouseMoveHandler,!1),this.handlersAdded=!0,this.mainHandlersAdded=!0,this.iframeMouseDownLeft=0,this.iframeMouseDownTop=0,this.pageMouseDownLeft=0,this.pageMouseDownTop=0,this.objectDragging=e,this.handles[this.handles.length]=e},isHandleClicked:function(e,t){if(e==t)return!0;for(;null!=t.parentNode;){if(t==e)return!0;t=t.parentNode}return!1},onMouseUpHandler:function(e){var t=new xEvent(e);xPreventDefault(t),this.dragging=!1},onMouseDownHandler:function(e){var t=new xEvent(e);if(xPreventDefault(t),!(null==this.handles||this.handles.length<1)){for(var i=!1,n=t.target,s=0;s<this.handles.length;s++)if(this.isHandleClicked(this.handles[s],n)){i=!0;break}if(!i)return!1;this.raiseSelectedIframe&&(this.iframe.style.zIndex=this.highestZIndex++),this.dragging=!0;var o={x:t.pageX,y:t.pageY};this.iframeMouseDownLeft=o.x,this.iframeMouseDownTop=o.y;var a={x:xPageX(this.iframe),y:xPageY(this.iframe)};this.pageMouseDownLeft=a.x-0+o.x,this.pageMouseDownTop=a.y-0+o.y}},onMouseMoveHandler:function(e){if(this.dragging){var t=new xEvent(e);xPreventDefault(t);var i={x:t.pageX,y:t.pageY};this.drag(i.x-this.iframeMouseDownLeft,i.y-this.iframeMouseDownTop)}},drag:function(e,t){var i={x:xPageX(this.iframe),y:xPageY(this.iframe)},n=i.x-0+e,s=i.y-0+t;this.allowDragOffScreen||(0>n&&(n=0),0>s&&(s=0)),xMoveTo(this.iframe,n,s),this.pageMouseDownLeft+=e,this.pageMouseDownTop+=t}});