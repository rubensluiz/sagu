<?php

class MLink extends MFormControl
{
    public $target='_self';
    public $href;
    public $onClick;


    public function __construct( $name = NULL, $label = NULL, $href = NULL, $text = NULL, $target = '_self' )
    {
        parent::__construct( $name, $href, $label );

        $this->caption = $text;
        $this->href    = $href;
        $this->onClick = '';
        $this->target  = $target;
    }


    public function setOnClick( $onClick )
    {
        $this->onClick = $onClick;
    }


    public function setText( $text )
    {
        $this->caption = $text;
    }


    public function setHREF( $href )
    {
        $this->href = $href;
    }


    public function setAction( $module = '', $action = '', $item = null, $args = null )
    {
        $this->setHREF( $this->manager->getActionURL( $module, $action, $item, $args ) );
    }


    public function generateInner()
    {
        if ( $this->readOnly )
        {
            $this->inner = HtmlPainter::Span( 'm-readonly', $this->name, $this->caption );

            return;
        }

        if ( $this->getClass() == '' )
        {
            $this->setClass( 'm-link' );
        }

        if ( $this->onClick != '' )
        {
            $this->addAttribute( 'onclick', $this->onClick );
        }

        if ( $this->target != '_self' )
        {
            $this->addAttribute( 'target', $this->target );
        }

        if ( $this->caption == '' )
        {
            $this->caption = $this->label;
        }

        $this->inner = $this->generateLabel() . $this->getRender('anchor');
    }

    function setTarget( $target )
    {
        $this->target = $target;
    }
}


class MLinkButton extends MLink
{
    private $generateLinkButton = true;
    
    public function __construct( $name = '', $label = '', $action = '' )
    {
        parent::__construct( $name, $label, $action );
    }

    public function getGenerateLinkButton()
    {
        return $this->generateLinkButton;
    }

    public function setGenerateLinkButton($generateLinkButton)
    {
        $this->generateLinkButton = $generateLinkButton;
    }

    public function generateLink()
    {
        $action  = $this->href;
        $form    = $this->page->name;
        $name    = str_replace( 'frm_', '', $this->name );
        $onclick = ( $name != '' ) ? "{$name}:click" : '';

        if ( count($this->eventHandlers) )
        {
            $param = $this->eventHandlers['click']['param'];
        }

        if ( $this->generateLinkButton )
        {
            $this->href = "javascript:_MIOLO_LinkButton('{$form}','{$action}','$onclick','$param','$this->target');";
        }
    }


    public function generateInner()
    {
        $this->generateLink();

        parent::generateInner();
    }

}


class MActionHyperLink extends MLink
{
    public function __construct( $name, $label, $module = '', $action = '', $item = null, $args = null )
    {
        parent::__construct( $name, $label );

        $this->setAction( $module, $action, $item, $args );
    }
}


class MImageLink extends MLink
{
    var $location;
    var $image;

    public function __construct( $name = '', $label = '', $action = '', $location = '', $attrs = NULL )
    {
        parent::__construct( $name, $label, $action );

        $this->location = $location;
        $this->setAttributes( $attrs );

        $this->image = new MImage( '', $label, $location, array('border' => '0') );
    }


    public function generateLink()
    {
        $this->caption = $this->image->generate();
    }

    public function generateInner()
    {
        $this->setClass( 'm-image-link' );
        $this->generateLink();

        parent::generateInner();
    }
}


class MImageLinkLabel extends MImageLink
{
    private $imageType = 'normal';


    public function setImageType( $type = 'normal' )
    {
        $this->imageType = $type;
    }


    public function generateLink()
    {
        if ( $this->imageType == 'normal' )
        {
            $this->image->generateInner();
            $image = new MDiv( '', $this->image->GetInner(), 'm-image-centered' );
            $text = new MSpan( '', $this->label, 'm-image-link-label m-image-label' );
            $this->caption = $image->generate() . $text->generate();
        }
        elseif ( $this->imageType == 'icon' )
        {
            $this->image->setClass( 'm-image-icon' );
            $this->image->generateInner();
            //          $image = new MSpan('', $this->image->GetInner());  
            $text = new MSpan( '', $this->label, 'm-image-link-label' );
            $this->caption = $this->image->generate() . $text->generate();
        }
    }
}


class MImageButton extends MImageLink
{
    public function generateLink()
    {
        parent::generateLink();

        $action  = $this->href;
        $form    = $this->page->name;
        $name    = str_replace( 'frm_', '', $this->name );
        $onclick = ($name != '') ? "{$name}:click" : '';

        $this->href = "javascript:_MIOLO_LinkButton('{$form}','{$action}','$onclick','','$this->target');";
        $this->target = '';
    }
}

class MImageButtonLabel extends MImageButton
{
    private $imageType = 'normal';

    public function setImageType($type = 'normal')
    {
        $this->imageType = $type;
    }

    public function generateLink()
    {
        parent::generateLink();

        if ( $this->imageType == 'normal' )
        {
            $this->setClass('m-image-centered');
            $text = new MSpan('', $this->label, 'm-image-link-label m-image-label');
        }
        elseif ( $this->imageType == 'icon' )
        {
            $this->image->setClass('m-image-icon');
            $text = new MSpan('', $this->label, 'm-image-link-label');
        }

        $this->caption = $this->image->generate() . $text->generate();
    }
}

?>