<?php

class EMioloException extends Exception
{
    public $goTo;
    protected $manager;

    public function __construct()
    {
        global $MIOLO;

        $this->manager = $MIOLO;

        if ( $this->manager->history )
        {
            $this->goTo = $this->manager->history->Back('action'); 
        }
        else
        {
            $this->goTo = MIOLO::getPreviousURL();
        }
    }
    
    public function __destruct()
    {
        if ( MIOLO::isDebugMode() )
        {
            MUtil::dumpString($this->getTraceAsString());
        }
    }

    public function Log()
    {
        $this->manager->LogError($this->message);
    }
}

class EInOutException extends EMioloException
{
}

class EDatabaseException extends EMioloException
{
    public function __construct($db, $msg)
    {
        parent::__construct();
        $this->message = _M('Error in Database [@1]: @2', 'miolo', $db, $msg);
        $this->Log();
    }
}

class EDatabaseExecException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = $msg;
    }
}

class EDatabaseQueryException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = $msg;
    }
}

class EDataNotFoundException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = _M('No Data Found!') . ($msg ? $msg : '');
    }
}

class EDatabaseTransactionException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = $msg;
    }
}

class EControlException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = $msg;
    }
}

class EUsesException extends EInOutException
{
    public function __construct($fileName)
    {
        parent::__construct();
        $this->message = _M("File [@1] not found by Uses!", 'miolo', $fileName);
        
        if ( MIOLO::isDebugMode() )
        {
            $this->message .= '<pre>' . $this->getTraceAsString() . '</pre>';
        }
        
        $this->Log();
    }
}

class EFileNotFoundException extends EInOutException
{
    public function __construct($fileName, $msg = '')
    {
        parent::__construct();
        $this->message = _M('@1 File not found: @2','miolo',$msg, $fileName);
        $this->Log();
    }
}

class ESessionException extends EMioloException
{
    public function __construct($op)
    {
        parent::__construct();
        $this->message = _M('Error in Session: ') . $op;
        $this->Log();
    }
}

class EBusinessException extends EMioloException
{
     public function __construct($msg)
     {
         parent::__construct();
         $this->message = _M('Error in getBusiness: ') . $msg;
         $this->Log();
     }
}

class ETimeOutException extends EMioloException
{
     public function __construct($msg='')
     {
         parent::__construct();
         $this->message = _M('Session finished by timeout.') . $msg;
         $this->Log();
     }
}

class ELoginException extends EMioloException
{
     public function __construct($msg='')
     {
         parent::__construct();
         $this->message = _M($msg);
         $this->goTo = $this->manager->getActionURL($this->manager->getConf('login.module'),'login'); //$this->manager->GetConf('home.url'); 
         $this->Log();
     }
}

class ESecurityException extends EMioloException
{
    public function __construct($msg)
    {
        parent::__construct();
        $this->message = $msg;
    }
}

?>
