<?php

class AcpTurmasEncerradas extends AcpOfertaTurma {
    
    public function searchGrid($ofertacursoid)
    {
        $msql = new MSQL();
        
        $msql->setTables('acpofertaturma');
        
        $msql->setColumns('
            acpofertaturma.ofertaturmaid,
            acpofertaturma.codigo,
            acpofertaturma.descricao,
            acpofertaturma.minimoalunos,
            acpofertaturma.maximoalunos,
            to_char(acpofertaturma.dataencerramento, getparameter(\'BASIC\', \'MASK_DATE\')),
            to_char(acpofertaturma.datainicialoferta, getparameter(\'BASIC\', \'MASK_DATE\')),
            to_char(acpofertaturma.datafinaloferta, getparameter(\'BASIC\', \'MASK_DATE\')),
            to_char(acpofertaturma.datainicialaulas, getparameter(\'BASIC\', \'MASK_DATE\')),
            to_char(acpofertaturma.datafinalaulas, getparameter(\'BASIC\', \'MASK_DATE\')),
            acpofertaturma.habilitada
        ');        
        
        $msql->setWhere('acpofertaturma.ofertacursoid = ? AND acpofertaturma.situacao = ?');
        $msql->setLimit(300);
        $sql = $msql->select(array($ofertacursoid, AcpOfertaTurma::SITUACAO_FECHADA));
        
        return SDatabase::query($sql);
    }
    
    public function searchAlunosDaTurma($ofertaturmaid)
    {
        $sql = "SELECT DISTINCT A.inscricaoid, 
                                C.name, 
                                acp_obtersituacaopedagogicadainscricao(A.inscricaoid)
                           FROM acpinscricaoturmagrupo A 
                      LEFT JOIN acpmatricula B ON (A.inscricaoturmagrupoid = B.inscricaoturmagrupoid) 
                 LEFT JOIN ONLY basperson C ON (B.personid = C.personid) 
                          WHERE A.ofertaturmaid = ?
                          AND acp_obtersituacaopedagogicadainscricao(A.inscricaoid) in ('Aprovado', 'Reprovado')
                          ORDER BY C.name";
        
        return SDatabase::query($sql, array($ofertaturmaid));
    }

}

?>
