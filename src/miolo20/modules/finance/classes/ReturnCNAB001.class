<?php
 /**
 * <--- Copyright 2005-2010 de Solis - Cooperativa de Soluções Livres Ltda.
 * 
 * Este arquivo é parte do programa Sagu.
 * 
 * O Sagu é um software livre; você pode redistribuí-lo e/ou modificá-lo
 * dentro dos termos da Licença Pública Geral GNU como publicada pela Fundação
 * do Software Livre (FSF); na versão 2 da Licença.
 * 
 * Este programa é distribuído na esperança que possa ser útil, mas SEM
 * NENHUMA GARANTIA; sem uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO
 * ou APLICAÇÃO EM PARTICULAR. Veja a Licença Pública Geral GNU/GPL em
 * português para maiores detalhes.
 * 
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título
 * "LICENCA.txt", junto com este programa, se não, acesse o Portal do Software
 * Público Brasileiro no endereço www.softwarepublico.gov.br ou escreva para a
 * Fundação do Software Livre (FSF) Inc., 51 Franklin St, Fifth Floor, Boston,
 * MA 02110-1301, USA --->
 * 
 *
 * This class return file bank Salary Banco do Brasil
 *
 * @author Leovan Tavares da Silva [leovan] [leovan@solis.coop.br]
 *
 * $version: $Id$
 *
 * \b Maintainers \n
 * Alexandre Heitor Schmidt [alexsmith@solis.coop.br]
 * Arthur Lehdermann [arthur@solis.coop.br]
 * Daniel Afonso Heisler [daniel@solis.coop.br]
 * Jamiel Spezia [jamiel@solis.coop.br]
 * Leovan Tavares da Silva [leovan@solis.coop.br]
 * Samuel Koch [samuel@solis.coop.br]
 * William Prigol Lopes [william@solis.coop.br]
 * 
 * @since
 * Class created on 14/06/2006
 *
 **/
 
/**
 *Class to return file bank Salary Banco do Brasil (001)
 * Eduardo Beal Miglioransa [eduardo@solis.coop.br]
 */

class returnCNAB001
{

     /**
     * Import the return file to database
     *
     * @param: $data: string to break and analyze
     *
     * @return (boolean): True if succeed, otherwise false
     */
    public function returnCNAB001($data)
    {
        $MIOLO  = MIOLO::getInstance();
        $module = MIOLO::getCurrentModule();

    
    }


     /**
     * Get the header and separate data in a array
     *
     * @param: $data (string): Header string data
     *
     * @return: (array): Array containing string data
     *
     */
    private function headerSegmento($data)
    {
        $header[] = substr($data, 0,   2);          // 001 a 003 - Código do Banco na compensação
        $header[] = substr($data, 3,   6);          // 004 a 007 - Lote de Serviço
        $header[] = substr($data, 7,   7);          // 008 a 008 - Registro Detalhe = '3'
        $header[] = substr($data, 8,   12);         // 009 a 013 - N° Seguencial do registro no Lote
        $header[] = substr($data, 13,  13);         // 014 a 014 - Cód. Seguimento do Reg Detalhe 
                                                        // se 'T' = Segmento T
                                                        // se 'U' = Segmento U
        $header[] = substr($data, 16,  16);         // 015 a 015 - Uso Exclusivo CNAB | Em Branco 
        $header[] = substr($data, 15,  16);         // 016 a 017 - Código de movimento
        return $header;
    }


    /**
     * Get the header and separate data in a array
     *
     * @param: $data (string): Header string data
     *
     * @return: (array): Array containing string data
     *
     */
    private function header($data)
    {
        $header[] = substr($data, 0,   2);          // 001 a 003 - Código do Banco na compensação
        $header[] = substr($data, 3,   6);          // 003 a 007 - Lote de Serviço
        $header[] = substr($data, 7,   7);          // 008 a 008 - Registro HEADER de arquivo '0'
        $header[] = substr($data, 8,  16);          // 009 a 017 - Uso Exclusivo CNAB | Em Branco
        $header[] = substr($data, 17,  17);         // 018 a 018 - Tipo inscr. '1' = CPF, '2' = CGC
        $header[] = substr($data, 18,  31);         // 019 a 032 - Inscrição da empresa | CPF ou CGC
        $header[] = substr($data, 32,  51);         // 033 a 052 - Código do convênio no Banco
        $header[] = substr($data, 52,  56);         // 053 a 057 - Agência mantenedora da conta
        $header[] = substr($data, 57,  57);         // 058 a 058 - Dígito Verificador da agência
        $header[] = substr($data, 58,  69);         // 059 a 070 - Número da conta corrente
        $header[] = substr($data, 70,  70);         // 071 a 071 - Dígito verificador da C/C
        $header[] = substr($data, 71,  71);         // 072 a 072 - Dígito verificador Ag/Conta|Branco
        $header[] = substr($data, 72,  101);        // 073 a 101 - Nome da empresa
        $header[] = substr($data, 102, 131);        // 103 a 132 - Nome do Banco
        $header[] = substr($data, 132, 141);        // 133 a 142 - USO CNAB/FEBRAN | Brancos
        $header[] = substr($data, 142, 142);        // 143 a 143 - Código REMESSA/RETORNO '2'=retorno
        $header[] = substr($data, 143, 150);        // 144 a 151 - Data Geração do Arquivo
        $header[] = substr($data, 151, 156);        // 152 a 157 - Hora geração do Arquivo
        $header[] = substr($data, 157, 162);        // 158 a 163 - N° Sequencial do arquivo
        $header[] = substr($data, 163, 165);        // 164 a 166 - N° Versão do Layout arquivo '30'
        $header[] = substr($data, 166, 170);        // 167 a 171 - Densidade de gravação do arq
        $header[] = substr($data, 171, 190);        // 172 a 191 - Reservado p/ uso Bancário
        $header[] = substr($data, 191, 210);        // 192 a 211 - Reservado p/ uso Empresa
        $header[] = substr($data, 211, 221);        // 212 a 222 - Uso exclusivo FEBRABAN/CNAB
        $header[] = substr($data, 222, 224);        // 223 a 225 - Identificação cobrança S/ papel
        $header[] = substr($data, 225, 227);        // 226 a 228 - Uso exclusivo das VANS
        $header[] = substr($data, 228, 229);        // 229 a 230 - Tipo de serviço
        $header[] = substr($data, 230, 239);        // 231 a 240 - Código das ocorrências
        return $header;
    }

     /**
     * Get the "header de lote" and separate data in a array
     *
     * @param: $data (string): Header string data
     *
     * @return: (array): Array containing string data
     *
     */
    private function headerLote($data)
    {
        $header[] = substr($data, 0,   2);          // 001 a 003 - Código do Banco na compensação
        $header[] = substr($data, 3,   6);          // 003 a 007 - Lote de Serviço
        $header[] = substr($data, 7,   7);          // 008 a 008 - Registro HEADER de lote | '1'
        $header[] = substr($data, 8,   8);          // 009 a 009 - Tipo da operação | 'C' = Crédito
        $header[] = substr($data, 9,   10);         // 010 a 011 - Tipo de serviço 
        $header[] = substr($data, 11,  12);         // 012 a 013 - Forma de lançamento
        $header[] = substr($data, 13,  15);         // 014 a 016 - N° da versão do Layout lote '20'
        $header[] = substr($data, 16,  16);         // 017 a 017 - Exclusivo FEBRABAN/CNAB | BRANCOS 

        $header[] = substr($data, 17,  17);         // 018 a 018 - Tipo inscr. '1' = CPF, '2' = CGC
        $header[] = substr($data, 18,  31);         // 019 a 032 - Inscrição da empresa | CPF ou CGC
        $header[] = substr($data, 32,  51);         // 033 a 052 - Código do convênio no Banco
        $header[] = substr($data, 52,  56);         // 053 a 057 - Agência mantenedora da conta
        $header[] = substr($data, 57,  57);         // 058 a 058 - Dígito Verificador da agência
        $header[] = substr($data, 58,  69);         // 059 a 070 - Número da conta corrente
        $header[] = substr($data, 70,  70);         // 071 a 071 - Dígito verificador da C/C
        $header[] = substr($data, 71,  71);         // 072 a 072 - Dígito verificador Ag/Conta|Branco
        $header[] = substr($data, 72,  101);        // 073 a 101 - Nome da empresa
        $header[] = substr($data, 102, 141);        // 103 a 142 - Mensagem

        $header[] = substr($data, 142, 171);        // 143 a 172 - Nome da Rua, AV. , PÇA, ETC
        $header[] = substr($data, 172, 176);        // 173 a 173 - N° do local
        $header[] = substr($data, 177, 191);        // 178 a 192 - CASA, Apto, Sala, ETC
        $header[] = substr($data, 192, 211);        // 193 a 212 - Nome da cidade
        $header[] = substr($data, 212, 216);        // 212 a 217 - CEP 
        $header[] = substr($data, 217, 219);        // 218 a 220 - Complemento CEP
        $header[] = substr($data, 220, 221);        // 221 a 222 - Sigla do estado
        $header[] = substr($data, 223, 229);        // 224 a 230 - Exclusivo FEBRABAN/CNAB
        $header[] = substr($data, 230, 239);        // 231 a 240 - Código das ocorrências
        return $header;
    }

     /**
     * Get the "Segmento T" and separate data in a array
     *
     * @param: $data (string): Header string data
     *
     * @return: (array): Array containing string data
     *
     */
    private function segmentoT($data)
    {

        $segmento   = $this->headerSegmento($data);
        $segmento[] = substr($data, 17,  21);         // 017 a 022 - Agência mantenedora
        $segmento[] = substr($data, 22,  22);         // 023 a 023 - Dígito verificador da agência
        $segmento[] = substr($data, 23,  34);         // 024 a 035 - Número da C/C
        $segmento[] = substr($data, 35,  35);         // 036 a 036 - Dígito verificador da agência
        $segmento[] = substr($data, 36,  36);         // 037 a 037 - DV da AG/Conta Corrente
        $segmento[] = substr($data, 37,  56);         // 038 a 057 - Identificação Título no Banco
        $segmento[] = substr($data, 57,  57);         // 058 a 058 - Código da carteira

        $segmento[] = substr($data, 58,  72);         // 057 a 073 - Número do Documento Cobrança
        $segmento[] = substr($data, 73,  81);         // 074 a 081 - Data do vencimento do título
        $segmento[] = substr($data, 81,  95);         // 082 a 096 - Valor nominal do título
        $segmento[] = substr($data, 96,  98);         // 097 a 099 - Número do banco
        $segmento[] = substr($data, 99,  103);        // 100 a 104 - Agência COBRADORA/RECEBEDORA
        $segmento[] = substr($data, 104, 104);        // 105 a 105 - DV da agência
        $segmento[] = substr($data, 105, 129);        // 106 a 130 - Identificação do título da Emp.
        $segmento[] = substr($data, 130, 131);        // 131 a 132 - Código da moeda
        $segmento[] = substr($data, 132, 132);        // 133 a 133 - Tipo de incrição
        $segmento[] = substr($data, 133, 147);        // 134 a 148 - Número de inscrição
        $segmento[] = substr($data, 148, 187);        // 149 a 188 - Nome
        $segmento[] = substr($data, 188, 197);        // 189 a 198 - N°do contr. da oper. de créd.
        $segmento[] = substr($data, 198, 212);        // 199 a 213 - Valor da tarifa/custas
        $segmento[] = substr($data, 213, 222);        // 214 a 223 - Id p/ rejeições, terifa, custas
        $segmento[] = substr($data, 223, 239);        // 224 a 240 - Uso exclusivo FEBRABAN/CNAB
        return $segmento;    
    }

     /**
     * Get the "Segmento U" and separate data in a array
     *
     * @param: $data (string): Header string data
     *
     * @return: (array): Array containing string data
     *
     */
    private function segmentoU($data)
    {

        $segmento   = $this->headerSegmento($data);

        $segmento[] = substr($data, 17,  31);         // 017 a 032 - Jurus/Multa/Encargos
        $segmento[] = substr($data, 32,  46);         // 033 a 047 - Valor desconto concedido
        $segmento[] = substr($data, 47,  61);         // 048 a 062 - Valor abat. concedido/cancel.
        $segmento[] = substr($data, 62,  76);         // 063 a 077 - Valor do IOF recolhido
        $segmento[] = substr($data, 77,  91);         // 078 a 092 - Valor pago sacado
        $segmento[] = substr($data, 93,  106);        // 092 a 107 - Valor líquido a ser creditado
        $segmento[] = substr($data, 107, 121);        // 108 a 122 - Valor de outras despesas
        $segmento[] = substr($data, 122, 136);        // 123 a 137 - Valor de outros créditos

        $segmento[] = substr($data, 137, 144);        // 138 a 145 - Data da ocorrência
        $segmento[] = substr($data, 145, 152);        // 146 a 153 - Data da efetivação do crédito
        $segmento[] = substr($data, 153, 156);        // 154 a 157 - Código da ocorrência
        $segmento[] = substr($data, 157, 164);        // 158 a 165 - Data da ocorrência do sacado

        $segmento[] = substr($data, 165, 179);        // 166 a 180 - Valor de ocorrência do sacado
        $segmento[] = substr($data, 180, 209);        // 181 a 210 - Complemento da ocorrência sac
        $segmento[] = substr($data, 210, 212);        // 211 a 213 - Código do Bnco corresp comp
        $segmento[] = substr($data, 213, 232);        // 214 a 233 - Nosso número bco corresp.
        $segmento[] = substr($data, 233, 239);        // 158 a 165 - Uso exclusivo FEBRABAN/CNAB

    }
}

?>


