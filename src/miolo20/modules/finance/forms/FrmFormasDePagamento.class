<?php

class FrmFormasDePagamento extends SManagementForm
{
    
    public function __construct()
    {
        parent::__construct(NULL, NULL, NULL, _M('Formas de pagamento'));
    }
    
    public function defineFields() 
    {
        $MIOLO  = MIOLO::getInstance();
        $module = $MIOLO->getCurrentModule();
        
        $toolbar = $this->getToolbar();
        $toolbar->disableButton(MToolBar::BUTTON_DELETE);
        $toolbar->disableButton(MToolBar::BUTTON_NEW);
        $toolbar->disableButton(MToolBar::BUTTON_PRINT);
        $toolbar->disableButton(MToolBar::BUTTON_SEARCH);
        
        $fields[] = new MLabel(_M('A integração com a Cielo permite que a instituição possa receber pagamento de títulos através de cartão de crédito.<br>
        Obs.: Para utilizar este serviço é necessário que a instituição seja credenciada pela Cielo. Mais informações em:<br>
        <a href="http://www.cielo.com.br">http://www.cielo.com.br</a>'));        
        $fields[] = new MSeparator('&nbsp;');
        
        $fields[] = new MCheckBox('habilitaCielo', 't', _M('Habilitar integração'), MUtil::getBooleanValue(SAGU::getParameter('FINANCE', 'CIELO')));
        $fields[] = new MTextField('instituicao', SAGU::getParameter('FINANCE', 'CIELO_COD_INSTITUICAO'), _M('Instituição'), SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'), _M('Código da instituição no serviço Cielo'));
        $fields[] = new MTextField('instituicaoChave', SAGU::getParameter('FINANCE', 'CIELO_CHAVE_INSTITUICAO'), _M('Chave da instituição'), SAGU::getParameter('BASIC', 'FIELD_DESCRIPTION_SIZE'), _M('Chave da instituição no serviço Cielo'));
        
        parent::defineFields($fields, $validators);
    }
    
    public function tbBtnSave_click() 
    {
        $busConfig = new BusinessBasicBusConfig();
        $data = $this->getData();
        
        // Parâmetro CIELO
        $configData = new stdClass();
        $configData->value = $data->habilitaCielo;
        $configData->moduleConfig = 'FINANCE';
        $configData->parameter = 'CIELO';
        $busConfig->updateConfigValue($configData);
        
        // Parâmetro CIELO_COD_INSTITUICAO
        $configData = new stdClass();
        $configData->value = $data->instituicao;
        $configData->moduleConfig = 'FINANCE';
        $configData->parameter = 'CIELO_COD_INSTITUICAO';
        $busConfig->updateConfigValue($configData);
        
        // Parâmetro CIELO_CHAVE_INSTITUICAO
        $configData = new stdClass();
        $configData->value = $data->instituicaoChave;
        $configData->moduleConfig = 'FINANCE';
        $configData->parameter = 'CIELO_CHAVE_INSTITUICAO';
        $busConfig->updateConfigValue($configData);
        
        $this->displayMessageUpdate();
    }
}

?>
