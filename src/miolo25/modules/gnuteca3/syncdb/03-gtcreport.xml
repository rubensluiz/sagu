<?xml version="1.0" encoding="UTF-8"?>
<gtcreport>                                                                                                                                                                                                                                                                
    <locate>reportid</locate>
    <locate>permission</locate>
    <ignoreOnUpdate>isactive</ignoreOnUpdate>    
    <item>
        <reportid>17</reportid>
        <title>Estatística - Reservas Material Emprestado</title>
        <description><![CDATA[ Gera a quantidade de reservas de materiais emprestados (material estava emprestado quando foi feita a reserva) realizadas num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        COUNT(DISTINCT reserveid) AS "Quantidade" 
        FROM 
            gtcreserve 
        WHERE
            requesteddate::date BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END AND 
            reservetypeid IN (1, 2);]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>18</reportid>
        <title>Estatística - Reservas Material Disponível</title>
        <description><![CDATA[ Gera a quantidade de reservas de materiais disponíveis (material estava disponível quando foi feita a reserva) realizadas num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        COUNT(DISTINCT reserveid) AS "Quantidade" 
        FROM 
            gtcreserve 
        WHERE 
            requesteddate::date BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END AND 
            reservetypeid NOT IN (1, 2);]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>19</reportid>
        <title>Estatística - Reserva vencida de Material Disponível</title>
        <description><![CDATA[ Gera a quantidade de reservas vencidas (usuário não retirou o material até a data limite) de materiais disponíveis (material estava disponível quando foi feita a reserva) realizadas num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        COUNT(DISTINCT reserveid) AS "Quantidade" 
        FROM 
            gtcreserve 
        WHERE 
            requesteddate::date BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END AND 
            reservetypeid NOT IN (1, 2) AND 
            reservestatusid IN (5, 6);]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>20</reportid>
        <title>Estatística - Reserva vencida de Material Emprestado</title>
        <description><![CDATA[ Gera a quantidade de reservas vencidas (usuário não retirou o material até a data limite) de materiais emprestados (material estava emprestado quando foi feita a reserva) realizadas num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        COUNT(DISTINCT reserveid) AS "Quantidade" 
        FROM 
            gtcreserve 
        WHERE 
            requesteddate::date BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END AND 
            reservetypeid IN (1, 2) AND 
            reservestatusid IN (5, 6);]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>21</reportid>
        <title>Estatística - Acervo Impresso (Livros)</title>
        <description><![CDATA[Gera a quantidade de Obras e Exemplares de livros da biblioteca, agrupado pelo CNPQ (áreas do conhecimento de acordo com o Conselho Nacional de Desenvolvimento Científico e Tecnológico).<BR>
    É necessário que o campo 901.b (Áreas do conhecimento) na catalogação dos livros esteja preenchido. <BR> <b>Restrições:</b><BR>Tipo físico: Impresso e Braille<BR>Tipo diferente de: Coleção de periódico, fascículo(periódico) e artigo de periódico<BR>Estado de exemplar diferente de: Desaparecido, Danificado e Descartado]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        C.description AS "CNPQ", 
        COUNT(DISTINCT A.controlnumber) AS "Quantidade de Obras", 
        COUNT(DISTINCT A.itemnumber) AS "Quantidade de Exemplares" 
    FROM 
        gtcexemplarycontrol A, 
        gtcmaterial B, 
        gtcmarctaglistingoption C 
    WHERE 
        A.controlnumber = B.controlnumber AND
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE A.originallibraryUnitId = $libraryUnitId END AND 
        A.materialphysicaltypeid IN (1, 8) AND 
        A.materialtypeid NOT IN (23, 24, 25) AND 
        A.exemplarystatusid NOT IN (4, 5, 8) AND 
        C.marctaglistingid = '901.b' AND 
        B.content = C.option AND 
        B.fieldid = '901' AND 
        B.subfieldid = 'b' 
    GROUP BY 1 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>22</reportid>
        <title>Estatística - Acervo Impresso (Periódicos)</title>
        <description><![CDATA[Gera a quantidade de Obras e Exemplares de livros da biblioteca, agrupado pelo CNPQ (áreas do conhecimento de acordo com o Conselho Nacional de Desenvolvimento Científico e Tecnológico).<BR>
    É necessário que o campo 901.b (Áreas do conhecimento) na catalogação dos periódicos esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        C.description AS "CNPQ", 
        COUNT(DISTINCT A.controlnumber) AS "Quantidade de Obras", 
        COUNT(DISTINCT A.itemnumber) AS "Quantidade de Exemplares" 
    FROM 
        gtcexemplarycontrol A, 
        gtcmaterial B, 
        gtcmarctaglistingoption C 
    WHERE 
        A.controlnumber = B.controlnumber AND
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE A.originallibraryUnitId = $libraryUnitId END AND 
        A.materialphysicaltypeid IN (1, 8) AND 
        A.materialtypeid IN (24) AND 
        A.exemplarystatusid NOT IN (4, 5, 8) AND 
        C.marctaglistingid = '901.b' AND 
        B.content = C.option AND 
        B.fieldid = '901' AND 
        B.subfieldid = 'b' 
    GROUP BY 1 
    ORDER BY 1]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>23</reportid>
        <title>Estatística - Empréstimos por CNPQ</title>
        <description><![CDATA[Gera a quantidade de empréstimos por CNPQ (áreas do conhecimento de acordo com o Conselho Nacional de Desenvolvimento Científico e Tecnológico).<BR>
    É necessário que o campo 901.b (Áreas do conhecimento) na catalogação esteja preenchido.<BR>
    * O relatório pode demorar para ser gerado caso o período de empréstimo informado no filtro seja muito grande.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        Z.content AS "ID", 
        W.description AS "CNPQ", 
        COUNT(DISTINCT X.loanid) + (SELECT COUNT(DISTINCT D.renewid) FROM gtcloan A, gtcexemplarycontrol B, gtcmaterial C, gtcrenew D WHERE A.itemnumber = B.itemnumber AND  B.controlnumber = C.controlnumber AND A.loanid = D.loanid AND  D.renewdate BETWEEN '$beginDate' AND '$endDate' AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE A.libraryUnitId         = $libraryUnitId
            END 
    AND  C.fieldid = '901' AND  C.subfieldid = 'b' AND C.content = Z.content) AS "Quantidade" 
    FROM 
    gtcloan X, 
    gtcexemplarycontrol Y, 
    gtcmaterial Z, 
    gtcmarctaglistingoption W 
    WHERE 
    X.itemnumber = Y.itemnumber AND 
    Y.controlnumber = Z.controlnumber AND 
    X.loandate::date BETWEEN '$beginDate' AND '$endDate'
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE X.libraryUnitId         = $libraryUnitId
            END AND 
    W.marctaglistingid = '901.b' AND 
    Z.content = W.option AND 
    Z.fieldid = '901' AND 
    Z.subfieldid = 'b' 
    GROUP BY 1, 2 
    ORDER BY 2;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>24</reportid>
        <title>Estatística - MNC</title>
        <description><![CDATA[Gera uma lista com os tipos de materiais não convencionais (CD, DVD, calculadora, fita, etc) e a quantidade de obras e exemplares de cada um]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        B.description AS "Tipo", 
        COUNT(DISTINCT A.controlnumber) AS "Quantidade de Obras", 
        COUNT(DISTINCT A.itemnumber) AS "Quantidade de Exemplares" 
    FROM 
        gtcexemplarycontrol A, 
        gtcmaterialphysicaltype B 
    WHERE 
        A.materialphysicaltypeid = B.materialphysicaltypeid AND
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE A.originallibraryUnitId = $libraryUnitId END AND  
        A.exemplarystatusid NOT IN (4, 5, 8) AND 
        A.materialtypeid <> 24 AND 
        A.materialphysicaltypeid NOT IN (1, 8, 9) 
    GROUP BY 1 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>25</reportid>
        <title>Estatística - Utilização Local</title>
        <description><![CDATA[Gera a quantidade de materiais utilizados localmente na biblioteca em determinado período, sem terem sidos retirados.<BR>
    Para isto é necessário que todos materiais encontrados nas mesas sejam devolvidos e que na tela de devolução do Circulação de material esteja selecionado o tipo: Utilização local.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        D.description AS "CNPQ", 
        COUNT(DISTINCT A.returnregisterid) AS "Quantidade" 
    FROM 
        gtcreturnregister A, 
        gtcexemplarycontrol B, 
        gtcmaterial C, 
        gtcmarctaglistingoption D  
    WHERE 
        A.returntypeid = 2 AND 
        A.itemnumber = B.itemnumber AND 
        B.controlnumber = C.controlnumber AND 
        B.line = C.line AND 
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE B.libraryUnitId = $libraryUnitId END AND 
        D.marctaglistingid = '901.b' AND 
        C.content = D.option AND 
        C.fieldid = '901' AND 
        C.subfieldid = 'b' AND 
        A.date::date BETWEEN '$beginDate' AND '$endDate' 
    GROUP BY 1 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>UTL</reportgroup>
    </item>
    <item>
        <reportid>1</reportid>
        <title>Estatística - Quantidade de exemplares por unidade</title>
        <description><![CDATA[Gera uma lista com a quantidade de exemplares por unidade.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[   SELECT A.libraryName as "Nome da biblioteca",
            count(B.itemNumber) as "Quantidade de exemplares"
        FROM gtcLibraryUnit      A
    LEFT JOIN gtcExemplaryControl B
        ON (A.libraryUnitId = B.originalLibraryUnitId)
        WHERE CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE B.libraryUnitId = $libraryUnitId END
    GROUP BY 1
    ORDER BY 2 DESC]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>2</reportid>
        <title>Estatística - Quantidade de obras por unidade</title>
        <description><![CDATA[Gera uma lista com a quantidade de obras por unidade.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[      SELECT A.libraryName as "Nome da biblioteca",
            count(distinct B.controlNumber) as "Quantidade de obras"
        FROM gtcLibraryUnit      A
    LEFT JOIN gtcExemplaryControl B
        ON (A.libraryUnitId = B.originalLibraryUnitId)
        WHERE CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE B.libraryUnitId = $libraryUnitId END
    GROUP BY 1
    ORDER BY 2 DESC]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>3</reportid>
        <title>Estatítisca - Empréstimos por classe</title>
        <description><![CDATA[Gera a quantidade de empréstimos por classes (classificação dada aos materiais) num determinado período.<BR>
    É necessário que o campo 090.a (Número da classificação) na Catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[   SELECT b.content as "Classe do Material", 
            count(a.loanId) as "Quantidade de Empréstimos" 
    FROM gtcLoan a, gtcMaterial b, gtcExemplaryControl c 
    WHERE a.itemNumber             = c.itemNumber 
        AND c.controlNumber          = b.controlNumber
        AND b.fieldId                = '090'
        AND b.subFieldId             = 'a'
        AND a.loanDate              >= '$beginDate'
        AND a.loanDate              <= '$endDate' 
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                 = 1
            ELSE a.libraryUnitId   = $libraryUnitId
            END
    GROUP BY b.content
    ORDER BY b.content]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>4</reportid>
        <title>Estatística - Empréstimos por grupo</title>
        <description><![CDATA[Gera a quantidade de empréstimos por grupos de usuários num determinado período.<BR>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[  SELECT a.linkId as "Código grupo",
            b.description as "Descrição",
            count(a.loanId) as "Empréstimos"
        FROM gtcloan a
    LEFT JOIN baslink b on a.linkId    = b.linkId
        WHERE loanDate::date                >= '$beginDate'
        AND loanDate::date                <= '$endDate'
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                   = 1
            ELSE a.libraryUnitId     = $libraryUnitId
            END
    GROUP BY a.linkId, b.description
    ORDER BY  b.description]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>5</reportid>
        <title>Estatística - Empréstimos por grupo x classe</title>
        <description><![CDATA[Gera a quantidade de empréstimos por <B>grupos de usuários X classe</B> (classificação dada aos materiais).<BR>
    É necessário que o campo 090.a (Número da classificação) na Catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[ SELECT a.linkId as "Código grupo", 
            d.description as "Grupo", 
            b.content as "Classe do Material", 
            count(a.loanId) as "Quantidade de Empréstimos"
        FROM gtcLoan             a, 
            gtcMaterial         b, 
            gtcExemplaryControl c, 
            baslink             d 
    WHERE a.itemNumber             = c.itemNumber 
        AND c.controlNumber          = b.controlNumber 
        AND a.linkId                 = d.linkId 
        AND b.fieldId                = '090' 
        AND b.subFieldId             = 'a' 
        AND a.loanDate::date              >= '$beginDate' 
        AND a.loanDate::date              <= '$endDate'
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                  = 1
            ELSE a.libraryUnitId    = $libraryUnitId
            END 
    group by a.linkId, d.description, b.content
    ORDER BY 1 desc]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>7</reportid>
        <title>Estatística - Renovações dos grupos</title>
        <description><![CDATA[Gera a quantidade de renovações por grupos de usuários num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[  SELECT a.linkid as "Código grupo", 
            b.description as "Grupo", 
            count(c.renewid) as "Quantidade de renovações" 
        FROM gtcloan  a, 
            baslink  b, 
            gtcrenew c 
    WHERE a.linkid                 = b.linkid 
        AND a.loanid                 = c.loanid 
        AND c.renewdate::date        >= '$beginDate' 
        AND c.renewdate::date        <= '$endDate'
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                  = 1
            ELSE a.libraryUnitId    = $libraryUnitId
            END
    GROUP BY a.linkid, b.description 
    ORDER BY a.linkid]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>8</reportid>
        <title>Estatítisca - Renovações das classes</title>
        <description><![CDATA[Gera a quantidade de renovações por classes (classificação dada aos materiais) num determinado período.<BR>
    É necessário que o campo 090.a (Número da classificação) na Catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[  SELECT b.content as "Classe do Material", 
    COUNT(d.renewid) as "Quantidade de renovações" 
    FROM gtcloan             a, 
            gtcmaterial         b, 
            gtcexemplarycontrol c, 
            gtcrenew            d 
    WHERE a.itemnumber             = c.itemnumber 
        AND c.controlnumber          = b.controlnumber 
        AND a.loanid                 = d.loanid 
        AND b.fieldId                = '090' 
        AND b.subFieldId             = 'a' 
        AND d.renewdate::date        >= '$beginDate' 
        AND d.renewdate::date        <= '$endDate'
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                 = 1
            ELSE a.libraryUnitId   = $libraryUnitId
            END 
    GROUP BY b.content 
    ORDER BY b.content]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>26</reportid>
        <title>Estatística - Materiais Apagados</title>
        <description><![CDATA[Gera a quantidade de materiais apagados em determinado período.<BR>
    Para isto, é necessário que após ter sido apagado, o material seja devolvido e que na tela de devolução do Circulação de material esteja selecionado o tipo: Apagados.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        COUNT(A.returnregisterid) AS "Quantidade" 
    FROM 
        gtcreturnregister A, 
        gtcexemplarycontrol B 
    WHERE 
        A.itemnumber = B.itemnumber AND 
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE B.libraryUnitId = $libraryUnitId END AND 
        A.returntypeid = 1 AND 
        A.date::date BETWEEN '$beginDate' AND '$endDate';]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RST</reportgroup>
    </item>
    <item>
        <reportid>27</reportid>
        <title>Lista de Coleções de Periódicos</title>
        <description><![CDATA[Gera uma lista com todos os títulos de coleções de periódicos.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            CASE WHEN 
                    B.content IS NULL 
            THEN 
                    A.content 
            ELSE 
                    A.content || ': ' || B.content 
            END AS "Título" 
    FROM 
            gtcmaterial A 
                    LEFT JOIN 
            gtcmaterial B 
                    ON (A.controlnumber = B.controlnumber AND 
                            B.fieldid = '245' AND 
                            B.subfieldid = 'b') 
    WHERE 
            A.controlnumber IN (SELECT DISTINCT controlnumber FROM gtckardexcontrol) AND 
            A.fieldid = '245' AND 
            A.subfieldid = 'a' 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    <item>
        <reportid>28</reportid>
        <title>Lista de títulos de VTs por CNPQ</title>
        <description><![CDATA[Gera uma lista com todos os títulos de vídeos por CNPQ (áreas do conhecimento de acordo com o Conselho Nacional de Desenvolvimento Científico e Tecnológico).<BR>
    É necessário que o campo 901.b (Áreas do conhecimento) na catalogação esteja preenchido e o campo 901.c (Tipo físico do material) seja DVD ou Fita VHS.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            CASE WHEN 
                    B.content IS NULL 
            THEN 
                    A.content 
            ELSE 
                    A.content || ': ' || B.content 
            END AS "Título" 
    FROM 
            gtcmaterial X 
                    INNER JOIN 
            gtcmaterial Y 
                    ON (Y.controlnumber = X.controlnumber AND X.fieldid = '901' AND X.subfieldid = 'b' AND X.content = '$cnpq' AND Y.fieldid = '901' AND Y.subfieldid = 'c' AND Y.content IN ('2','3')) 
                    INNER JOIN 
            gtcmaterial A 
                    ON (A.controlnumber = Y.controlnumber)
                    LEFT JOIN 
            gtcmaterial B 
                    ON (A.controlnumber = B.controlnumber AND 
                            B.fieldid = '245' AND 
                            B.subfieldid = 'b') 
    WHERE 
            A.fieldid = '245' AND 
            A.subfieldid = 'a' 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    <item>
        <reportid>9</reportid>
        <title>Estatística - Renovações dos grupo X classe</title>
        <description><![CDATA[Gera a quantidade de renovações por <B>grupos de usuários X classe</B>  (classificação dada aos materiais).<BR>
    É necessário que o campo 090.a (Número da classificação) na Catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[ SELECT a.linkId as "Código grupo", 
            d.description as "Grupo", 
            b.content as "Classe do Material", 
            count(e.renewid) as "Quantidade de Renovações" 
        FROM gtcLoan             a, 
            gtcMaterial         b, 
            gtcExemplaryControl c, 
            baslink             d, 
            gtcrenew            e 
    WHERE a.itemNumber             = c.itemNumber 
        AND c.controlNumber          = b.controlNumber 
        AND a.linkId                 = d.linkId 
        AND a.loanid                 = e.loanid 
        AND b.fieldId                = '090' 
        AND b.subFieldId             = 'a' 
        AND e.renewDate::date        >= '$beginDate' 
        AND e.renewDate::date        <= '$endDate' 
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                  = 1
            ELSE a.libraryUnitId    = $libraryUnitId
            END
    GROUP BY a.linkId, d.description, b.content 
    ORDER BY 1 desc]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>12</reportid>
        <title>Atrasados por classificação</title>
        <description><![CDATA[Gera uma lista ordenada pela classificação dos materiais atrasados dentro de um determinado período.<BR> 
    Antes de avisar os usuários que seu empréstimo está atrasado, é bom conferir se por ventura o material não está na prateleira.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[(SELECT 
        A.personid AS "Código", 
        B.name AS "Nome", 
        A.itemnumber AS "Exemplar", 
        C.content || '  ' || D.content AS "Classificação", 
        (SELECT content FROM gtcmaterial WHERE fieldid = '250' AND subfieldid = 'a' AND controlnumber = C.controlnumber) AS "Edição", 
        (SELECT content FROM gtcmaterial WHERE fieldid = '949' AND subfieldid = 'v' AND controlnumber = C.controlnumber AND line = E.line) AS "Volume", 
        DATE(A.loandate) AS "Empréstimo", 
        DATE(A.returnforecastdate) AS "Prev. Devolução" 
    FROM 
        gtcLoan A, 
        basperson B, 
        gtcmaterial C, 
        gtcmaterial D, 
        gtcExemplaryControl E 
    WHERE
        A.personid = B.personid AND 
        A.itemNumber = E.itemNumber AND 
        E.controlNumber = C.controlNumber AND 
        C.controlNumber = D.controlNumber AND  
        C.fieldId = '090' AND 
        C.subFieldId = 'a' AND 
        D.fieldId = '090' AND 
        D.subFieldId = 'b' AND 
        A.returnforecastdate < DATE(NOW()) AND 
        DATE(A.returnforecastdate) >= '$beginDate' AND 
        DATE(A.returnforecastdate) <= '$endDate' AND 
        A.returndate IS NULL AND 
        A.itemnumber NOT ILIKE 'P%' AND 
        CASE WHEN $libraryUnitId = 0
            THEN 1 = 1 
        ELSE 
            A.libraryUnitId = $libraryUnitId 
        END
    ORDER BY 
        SUBSTR(A.itemnumber, 0, 2), 
            SUBSTR(C.content, 0, 2), 
        REPLACE(C.searchcontent, '@', '1'), 
        D.content)
    UNION ALL 
    (SELECT 
        A.personid AS "Código", 
        B.name AS "Nome", 
        A.itemnumber AS "Exemplar", 
        C.content || '  ' || D.content || ' ' || F.content AS "Classificação", 
        (SELECT content FROM gtcmaterial WHERE fieldid = '250' AND subfieldid = 'a' AND controlnumber = C.controlnumber) AS "Edição", 
        (SELECT content FROM gtcmaterial WHERE fieldid = '949' AND subfieldid = 'v' AND controlnumber = C.controlnumber AND line = E.line) AS "Volume", 
        DATE(A.loandate) AS "Empréstimo", 
        DATE(A.returnforecastdate) AS "Prev. Devolução" 
    FROM 
        gtcLoan A, 
        basperson B, 
        gtcmaterial C, 
        gtcmaterial D, 
        gtcExemplaryControl E, 
        gtcmaterial F 
    WHERE
        A.personid = B.personid AND 
        A.itemNumber = E.itemNumber AND 
        E.controlNumber = C.controlNumber AND 
        C.controlNumber = D.controlNumber AND 
        D.controlNumber = F.controlNumber AND 
        C.fieldId = '090' AND 
        C.subFieldId = 'a' AND 
        D.fieldId = '090' AND 
        D.subFieldId = 'b' AND 
        F.fieldId = '362' AND 
        F.subFieldId = 'a' AND 
        A.returnforecastdate < DATE(NOW()) AND 
        DATE(A.returnforecastdate) >= '$beginDate' AND 
        DATE(A.returnforecastdate) <= '$endDate' AND 
        A.returndate IS NULL AND 
        A.itemnumber ILIKE 'P%' AND 
        CASE WHEN $libraryUnitId = 0
            THEN 1 = 1 
        ELSE 
            A.libraryUnitId = $libraryUnitId 
        END
    ORDER BY 
        SUBSTR(A.itemnumber, 0, 2), 
        REPLACE(C.searchcontent, '@', '1'), 
        D.content, 
        F.content)]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>13</reportid>
        <title>Conferir reservas atendidas</title>
        <description><![CDATA[Gera uma lista com todas as reservas atendidas e comunicadas, para conferir se estão na biblioteca.<BR> É recomendado sempre fazer esta conferência antes de avisar os usuários sobre a chegada de sua reserva.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[ SELECT A.itemnumber, D.content, E.content
                FROM gtcreservecomposition A 
                LEFT JOIN gtcreserve B 
                ON (A.reserveid = B.reserveid) 
                LEFT JOIN gtcexemplarycontrol C 
                ON (A.itemnumber = C.itemnumber) 
                LEFT JOIN gtcmaterial D 
                ON (C.controlnumber = D.controlnumber AND D.fieldid = '090' AND D.subfieldid = 'a') 
                LEFT JOIN gtcmaterial E 
                ON (D.controlnumber = E.controlnumber AND E.fieldid = '090' AND E.subfieldid = 'b') 
                WHERE A.isconfirmed = 't' AND B.reservestatusid IN (2, 3) AND 
                CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE C.libraryUnitId = $libraryUnitId END 
                ORDER BY SUBSTR(C.itemnumber, 0, 2), SUBSTR(D.content, 0, 2), 
                REPLACE(D.searchcontent, '@', '1'), 
                E.content;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>14</reportid>
        <title>Reservas disponíveis</title>
        <description><![CDATA[Gera uma lista com todas as reservas de materiais disponíveis que ainda não foram atendidas.<BR> É útil para pegar os materiais nas prateleiras e separá-los junto com os outros reservados.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[SELECT 
        result."Cód. Reserva", 
        result."Classificação", 
        result."Exemplar", 
        (SELECT Y.description FROM gtcexemplarycontrol X, gtcmaterialtype Y where X.itemnumber = result."Exemplar" AND X.materialtypeid = Y.materialtypeid LIMIT 1) as "Tipo", 
        (SELECT Y.description FROM gtcexemplarycontrol X, gtcmaterialphysicaltype Y where X.itemnumber = result."Exemplar" AND X.materialphysicaltypeid = Y.materialphysicaltypeid LIMIT 1) as "Tipo Físico", 
        (SELECT Y.content FROM gtcexemplarycontrol X, gtcmaterial Y where X.itemnumber = result."Exemplar" AND Y.fieldid = '949' AND Y.subfieldid = 'v' AND X.line = Y.line AND X.controlnumber = Y.controlnumber LIMIT 1) as "Volume", 
        (SELECT Y.content FROM gtcexemplarycontrol X, gtcmaterial Y where X.itemnumber = result."Exemplar" AND Y.fieldid = '250' AND Y.subfieldid = 'a' AND X.line = Y.line AND X.controlnumber = Y.controlnumber LIMIT 1) as "Edição" 
    FROM (
        (SELECT 
            DISTINCT B.reserveid AS "Cód. Reserva", 
            D.content || '   ' || E.content AS "Classificação",
            (SELECT x.itemnumber FROM gtcexemplarycontrol X, gtcreservecomposition Y WHERE X.itemnumber = Y.itemnumber AND Y.reserveid = B.reserveid LIMIT 1) AS "Exemplar", 
            SUBSTR((SELECT x.itemnumber FROM gtcexemplarycontrol X, gtcreservecomposition Y WHERE X.itemnumber = Y.itemnumber AND Y.reserveid = B.reserveid LIMIT 1), 0, 2), 
            SUBSTR(D.content, 0, 2), 
            REPLACE(D.searchcontent, '@', '1')
        FROM 
            gtcreservecomposition A, 
            gtcreserve B, 
            gtcexemplarycontrol C, 
            gtcmaterial D, 
            gtcmaterial E 
        WHERE 
            A.reserveid = B.reserveid AND 
            A.itemnumber = c.itemnumber AND
            C.controlnumber = D.controlnumber AND 
            D.controlnumber = E.controlnumber AND 
            D.fieldid = '090' AND 
            D.subfieldid = 'a' AND 
            E.fieldid = '090' AND 
            E.subfieldid = 'b' AND 
            B.reservestatusid = 1 AND 
            B.libraryUnitId = 1 AND 
            B.reservestatusid = 1 AND 
            C.materialtypeid <> 24 AND 
            C.exemplarystatusid = 1 AND 
            CASE WHEN $libraryUnitId = 0
            THEN 1 = 1 
            ELSE 
                B.libraryUnitId = $libraryUnitId 
            END
        ORDER BY 
            4, 5, 6) 
        UNION ALL 
        (SELECT 
            DISTINCT B.reserveid AS "Cód. Reserva", 
            D.content || '   ' || E.content || '   ' || F.content AS "Classificação",
            (SELECT x.itemnumber FROM gtcexemplarycontrol X, gtcreservecomposition Y WHERE X.itemnumber = Y.itemnumber AND Y.reserveid = B.reserveid LIMIT 1) AS "Tipo", 
            SUBSTR((SELECT x.itemnumber FROM gtcexemplarycontrol X, gtcreservecomposition Y WHERE X.itemnumber = Y.itemnumber AND Y.reserveid = B.reserveid LIMIT 1), 0, 2), 
            SUBSTR(D.content, 0, 2), 
            REPLACE(D.searchcontent, '@', '1')
        FROM 
            gtcreservecomposition A, 
            gtcreserve B, 
            gtcexemplarycontrol C, 
            gtcmaterial D, 
            gtcmaterial E, 
            gtcmaterial F 
        WHERE 
            A.reserveid = B.reserveid AND 
            A.itemnumber = c.itemnumber AND
            C.controlnumber = D.controlnumber AND 
            D.controlnumber = E.controlnumber AND 
            E.controlnumber = F.controlnumber AND 
            D.fieldid = '090' AND 
            D.subfieldid = 'a' AND 
            E.fieldid = '090' AND 
            E.subfieldid = 'b' AND 
            F.fieldid = '362' AND 
            F.subfieldid = 'a' AND 
            B.reservestatusid = 1 AND 
            B.libraryUnitId = 1 AND 
            B.reservestatusid = 1 AND 
            C.materialtypeid = 24 AND 
            C.exemplarystatusid = 1 AND 
            CASE WHEN $libraryUnitId = 0
            THEN 1 = 1 
            ELSE 
                B.libraryUnitId = $libraryUnitId 
            END
        ORDER BY 
            4, 5, 6)
    ) result]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>15</reportid>
        <title>Restaurandos</title>
        <description><![CDATA[Gera uma lista de todos os materiais que estão no estado restauração, com o número do tombo e seu respectivo título.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            DISTINCT A.itemnumber, 
            B.content 
    FROM 
            gtcexemplarycontrol A, 
            gtcmaterial B, 
            gtcexemplarystatushistory C 
    WHERE 
            A.controlnumber = B.controlnumber AND 
            A.itemnumber = C.itemnumber AND 
            A.exemplarystatusid = 6 AND 
            B.fieldid = '245' AND 
            B.subfieldid = 'a' AND 
            C.exemplarystatusid = 6 AND 
            C.date::date > '$beginDate' 
    ORDER BY 2]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RST</reportgroup>
    </item>
    <item>
        <reportid>16</reportid>
        <title>Nota fiscal mês</title>
        <description><![CDATA[Gera uma lista com a quantidade de materiais cadastrados por nota fiscal e centro de custo num determinado mês.<BR>
    É necessário o preenchimento dos seguintes campos na catalogação:<BR>
    949.f - Nota fiscal<BR>
    949.h - Data da nota fiscal<BR>
    949.q - Centro de custo]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[select 
        A.content, b.content, G.description, H.description, COUNT(F.itemnumber), C.content, E.libraryname 
        FROM 
        gtcmaterial A, gtcmaterial B, gtcmaterial C, gtclibraryunit E, gtcexemplarycontrol F, gtcmaterialphysicaltype G, gtcmaterialtype H 
        where 
        F.acquisitiontype = 'C' and F.controlnumber = A.controlnumber and 
        F.line = A.line and a.fieldid = '949' and a.subfieldid = 'f' and A.controlnumber = B.controlnumber and 
        A.line = B.line and b.fieldid = '949' and b.subfieldid = 'h' and b.content ilike '$data' and B.controlnumber = C.controlnumber and 
        B.line = C.line and c.fieldid = '949' and c.subfieldid = 'q' and 
        F.materialtypeid <> 24 AND 
        F.originallibraryUnitId = E.libraryUnitId AND 
        G.materialphysicaltypeid = F.materialphysicaltypeid and 
        H.materialtypeid = F.materialtypeid 
        Group by 1, 2, 3, 4, 6, 7 
        Order by 7, 1, 2, 3, 4, 6, 5;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>29</reportid>
        <title>Estatística - Coleções X Quantidade de Fascículos</title>
        <description><![CDATA[Gera uma lista com todos os títulos das coleções e a respectiva quantidade de fascículos.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            A.content AS "Coleção", 
            COUNT(DISTINCT B.controlnumber) AS "Quantidade de Fascículos" 
    FROM 
            gtcmaterial A, 
            gtcmaterial B, 
            gtckardexcontrol C 
    WHERE 
            A.controlnumber::TEXT = B.content AND 
            A.controlnumber = C.controlnumber AND 
            A.fieldid = '245' AND 
            A.subfieldid = 'a' AND 
            B.fieldid = '773' AND 
            B.subfieldid = 'w' 
    GROUP BY 1 
    ORDER BY 1 ASC;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>30</reportid>
        <title>Estatística - Exemplares Catalogados por Unidade</title>
        <description><![CDATA[Gera a quantidade de exemplares (todos os tipos de materiais) cadastrados num determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            COUNT(*) AS "Quantidade" 
    FROM 
            gtcexemplarycontrol 
    WHERE 
            entrancedate::date BETWEEN '$beginDate' AND '$endDate' AND
        CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE originallibraryUnitId = $libraryUnitId END;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>31</reportid>
        <title>Estatística - Artigos Processados por Mês</title>
        <description><![CDATA[Gera a quantidade de artigos cadastrados por período em todas as biliotecas]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            COUNT(*) 
    FROM 
            gtcmaterialcontrol 
    WHERE 
            entrancedate BETWEEN '$beginDate' AND '$endDate' AND 
            category = 'SA' AND 
            level = '4';]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>32</reportid>
        <title>Lista de coleções por CNPQ</title>
        <description><![CDATA[Gera uma lista contendo a classificação e o título de todas coleções, agrupadas pelo CNPQ (áreas do conhecimento de acordo com o Conselho Nacional de Desenvolvimento Científico e Tecnológico).<BR>
    É necessário que os seguinte campos na catalogação estejam preenchidos:<BR>
    090.a - Número de classificação<BR>
    090.b - Cutter<BR>
    245.a - Título<BR>
    901.b - Áreas do conhecimento]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT DISTINCT
            C.content AS "Classificação", 
            D.content AS "Cutter", 
            B.content ||
                    CASE WHEN
                        (SELECT content FROM gtcmaterial WHERE fieldid = '245' AND subfieldid = 'b' AND controlnumber = D.controlnumber) IS NULL
                    THEN
                        ''
                    ELSE
                        ':' || (SELECT content FROM gtcmaterial WHERE fieldid = '245' AND subfieldid = 'b' AND controlnumber = D.controlnumber)
                    END AS "Título", 
            F.description AS "CNPQ" 
    FROM 
            gtcmaterial B,
            gtcmaterial C, 
            gtcmaterial D, 
            gtcmaterial E, 
            gtcmarctaglistingoption F 
    WHERE 
            B.controlnumber = C.controlnumber AND 
            C.controlnumber = D.controlnumber AND 
            D.controlnumber = E.controlnumber AND 
            C.fieldid = '090' AND 
            C.subfieldid = 'a' AND 
            D.fieldid = '090' AND 
            D.subfieldid = 'b' AND 
            E.fieldid = '901' AND 
            E.subfieldid = 'b' AND 
            E.content = F.option AND 
            F.marctaglistingid = '901.b' AND 
            B.controlnumber IN (SELECT DISTINCT controlnumber FROM gtckardexcontrol) AND 
            B.fieldid = '245' AND 
            B.subfieldid = 'a' 
    ORDER BY 4, 1, 2;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    <item>
        <reportid>33</reportid>
        <title>Estatística - Estimativa de Visita</title>
        <description><![CDATA[Gera uma estimativa de quantas pessoas utilizaram a biblioteca num determinado período.<BR>
    Soma a quantidade de empréstimos, devoluções, renovações, reservas solicitadas e confirmadas por pessoas diferentes.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            COUNT(DISTINCT result."A")
    FROM 
            (
            (SELECT 
                    DISTINCT personid::TEXT || '-' || DATE_PART('hour', loandate) || '-' || DATE_PART('day', loandate) AS "A" 
            FROM 
                    gtcloan 
            WHERE 
                    loandate::date BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END 
            )
            UNION
            (SELECT 
                    DISTINCT personid::TEXT || '-' || DATE_PART('hour', returndate) || '-' || DATE_PART('day', returndate) AS "A" 
            FROM 
                    gtcloan 
            WHERE 
                    returndate BETWEEN '$beginDate' AND '$endDate' AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END 
            ) 
            UNION 
            (SELECT 
                    DISTINCT personid::TEXT || '-' || DATE_PART('hour', requesteddate) || '-' || DATE_PART('day', requesteddate) AS "A" 
            FROM 
                    gtcreserve 
            WHERE 
                    requesteddate BETWEEN '$beginDate' AND '$endDate' AND 
                    reservetypeid IN (1, 3) AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END 
            )
        UNION 
        (SELECT 
            DISTINCT Y.personid::TEXT || '-' || DATE_PART('hour', renewdate) || '-' || DATE_PART('day', renewdate) AS "A" 
        FROM 
            gtcrenew X, 
            gtcloan Y 
        WHERE 
            X.loanid = Y.loanid AND 
            CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE libraryUnitId = $libraryUnitId END AND 
            renewdate BETWEEN '$beginDate' AND '$endDate'
        )
        ) AS result;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>UTL</reportgroup>
    </item>
    <item>
        <reportid>34</reportid>
        <title>Estatística - Materiais Inseridos no Sistema por operador</title>
        <description><![CDATA[Gera uma lista com os operadores e a quantidade de materiais (artigos, coleções, exemplares e kardex) que cada um cadastrou num determinado período.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[SELECT 
            'Exemplares', 
            operator, 
            COUNT(*) 
    FROM 
            gtcmaterialhistory 
    WHERE 
            fieldid = '949' AND 
            subfieldid = 'a' AND 
            data::date BETWEEN '$beginDate' AND '$endDate' AND 
            chancestype = 'I' 
    GROUP BY 1, 2 
    UNION 
    SELECT 
            'Artigos', 
            B.operator, 
            COUNT(*) 
    FROM 
            gtcmaterialcontrol A, 
            gtcmaterialhistory B 
    WHERE 
            A.controlnumber = B.controlnumber AND 
            A.category = 'SA' AND 
            A.level = '4' AND 
            B.fieldid = '773' AND 
            B.subfieldid = 'w' AND 
            B.data::date BETWEEN '$beginDate' AND '$endDate' AND 
            B.chancestype = 'I' 
    GROUP BY 1, 2 
    UNION 
    SELECT 
            'Kardex', 
            operator, 
            COUNT(*) 
    FROM 
            gtcmaterialhistory 
    WHERE 
            fieldid = '960' AND 
            subfieldid = 'a' AND 
            data::date BETWEEN '$beginDate' AND '$endDate' AND 
            chancestype = 'I' 
    GROUP BY 1, 2 
    UNION 
    SELECT 
            'Coleções', 
            B.operator, 
            COUNT(*) 
    FROM 
            gtcmaterialcontrol A, 
            gtcmaterialhistory B 
    WHERE 
            A.controlnumber = B.controlnumber AND 
            A.category = 'SE' AND 
            A.level = '#' AND 
            B.fieldid = '245' AND 
            B.subfieldid = 'a' AND 
            B.data::date BETWEEN '$beginDate' AND '$endDate' AND 
            B.chancestype = 'I' 
    GROUP BY 1, 2  
    ORDER BY 1, 2;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>35</reportid>
        <title>Estatística - Empréstimos Por Turno</title>
        <description><![CDATA[Gera a quantidade de empréstimos + renovações locais por turno.<BR>
    Para seu correto funcionamento, deve ser selecionado 1 dia de cada vez.<BR>
    * Manhã: entre 0 e 12 horas<BR>
    * Tarde: entre 12 e 18 horas<BR>
    * Noite: entre 18 e 24 horas]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
    '1-Manhã' AS "Turno", 
            count(distinct loanId) + (SELECT COUNT(DISTINCT B.renewId) 
        FROM gtcLoan A, gtcRenew B 
            WHERE A.loanId = B.loanId 
            AND B.renewdate BETWEEN '$beginDate 00:00:00' AND '$endDate 12:00:00' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
            AND B.renewtypeid = 1 ) 
            AS "Quantidade" 
        FROM gtcLoan 
            WHERE loanDate BETWEEN '$beginDate 00:00:00' AND '$endDate 12:00:00' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
    UNION SELECT 
    '2-Tarde' AS "Turno", 
            count(distinct loanId) + (SELECT COUNT(DISTINCT B.renewId) 
        FROM gtcLoan A, gtcRenew B 
            WHERE A.loanId = B.loanId 
            AND B.renewdate BETWEEN '$beginDate 12:00:00' AND '$endDate 18:00:00' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
            AND B.renewtypeid = 1 ) 
                AS "Quantidade" 
        FROM gtcLoan 
            WHERE loanDate BETWEEN '$beginDate 12:00:00' AND '$endDate 18:00:00' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
    UNION SELECT 
    '3-Noite' AS "Turno", 
            count(distinct loanId) + (SELECT COUNT(DISTINCT B.renewId) 
        FROM gtcLoan A, gtcRenew B 
            WHERE A.loanId = B.loanId 
            AND B.renewdate BETWEEN '$beginDate 18:00:00' AND '$endDate 00:00:00' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
            AND B.renewtypeid = 1 ) 
                AS "Quantidade" 
        FROM gtcLoan 
            WHERE loanDate BETWEEN '$beginDate 18:00:00' AND '$endDate 23:59:59' 
            AND CASE WHEN $libraryUnitId = 0
            THEN 1                     = 1
            ELSE libraryUnitId         = $libraryUnitId
            END 
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>36</reportid>
        <title>Estatística - Materiais Processados por Mês</title>
        <description><![CDATA[Gera uma lista com a quantidade de materiais (exemplares, artigos e obras) cadastrados em determinado período para a primeira biblioteca do sistema.<BR>
    A geração deste relatório pode ser demorada.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            '1-Exemplares' AS "Materiais", 
            COUNT(*) AS "Quantidade" 
    FROM 
            gtcexemplarycontrol 
    WHERE 
            entrancedate::date BETWEEN '$beginDate' AND '$endDate'
    UNION 
    SELECT 
            '2-Artigos' AS "Materiais",
            COUNT(*) AS "Quantidade" 
    FROM 
            gtcmaterialcontrol 
    WHERE 
            entrancedate::date BETWEEN '$beginDate' AND '$endDate' AND 
            category = 'SA' AND 
            level = '4' 
    UNION 
    SELECT 
            '3-Obras' AS "Materiais", 
            COUNT(*) AS "Quantidade" 
    FROM 
            gtcmaterialcontrol 
    WHERE 
            entrancedate::date BETWEEN '$beginDate' AND '$endDate' ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>37</reportid>
        <title>Obras mais retiradas</title>
        <description><![CDATA[Lista o título das obras mais retiradas num determinado período.<BR>
    Para não demorar muito a geração do relatório, foi incluído um limite de itens na listagem.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[SELECT 
            c.controlNumber as "Número de controle", c.content as "Título", count(distinct a.loanId) as "Quantidade de empréstimos" 
    FROM    gtcLoan a, 
            gtcExemplaryControl b, 
            gtcMaterial c 
    WHERE   a.itemNumber = b.itemNumber AND 
            b.controlNumber = c.controlNumber AND 
            a.loanDate::date >= '$beginDate' AND 
            a.loanDate::date <= '$endDate' AND 
            (c.fieldId = '245' and c.subfieldId = 'a') 
            AND CASE WHEN $libraryUnitId = 0 THEN 1 = 1 ELSE a.libraryUnitId = $libraryUnitId END 
    GROUP BY c.controlNumber, 
            c.content ORDER BY 3 desc limit $limit]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>6</reportid>
        <title>Obras mais reservadas</title>
        <description><![CDATA[Lista o título das obras mais reservadas num determinado período.<BR>
    Para não demorar muito a geração do relatório, foi incluído um limite de itens na listagem.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[  SELECT d.controlNumber as "Número de controle", d.content as "Título", 
            count(distinct b.reserveId) as "Quantidade de reservas" 
        FROM gtcReserve            a, 
            gtcReserveComposition b, 
            gtcExemplaryControl   c, 
            gtcMaterial           d 
    WHERE a.reserveId              = b.reserveId 
        AND b.itemNumber             = c.itemNumber 
        AND c.controlNumber          = d.controlNumber 
        AND a.requestedDate::date    >= '$beginDate'
        AND a.requestedDate::date    <= '$endDate' 
        AND (d.fieldId = '245' and d.subfieldId = 'a') 
        AND CASE WHEN $libraryUnitId = 0
            THEN 1                 = 1
            ELSE a.libraryUnitId   = $libraryUnitId
            END
    GROUP BY d.controlNumber, d.content 
    ORDER BY 3 desc limit $limit]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>RES</reportgroup>
    </item>
    <item>
        <reportid>38</reportid>
        <title>Gerenciamento de Dicionários</title>
        <description><![CDATA[Relatório de gerenciamento de dicionário visa detectar quais informações estão faltando ou sobrando em um dicionario, facilitando suas manutenção.
    <br/>
    <b>Sobrando:</b> quer dizer que o dado está sobrando no dicionário, ou seja nunca foi usado em nenhum material.
    <br/>
    <b>Faltando:</b> significa que o conteúdo foi utilizado em algum material, mas não foi adicionado ao dicionário.]]></description>
        <permission>intermediary</permission>
        <reportsql><![CDATA[SELECT '''' || content || '''' as "Conteúdo", 'Faltando' as "Tipo" FROM (
    SELECT distinct content
    FROM
    (
        SELECT substring(subTag, 0, position('.' in subTag)) as field,
            substring(subTag, position('.' in subTag)+1) as subfield
        FROM regexp_split_to_table( (
                    SELECT tags
                    FROM gtcDictionary where dictionaryid =$dictionaryId ) , ',' ) AS subTag )
            AS tags
    INNER JOIN gtcMaterial M ON (tags.field = M.fieldid AND tags.subfield = M.subfieldID )

    EXCEPT

    SELECT dictionaryContent FROM gtcDictionaryContent where dictionaryId = $dictionaryId

    ) as faltando

    UNION

    SELECT '''' || dictionaryContent || '''' as "Conteúdo", 'Sobrando' as "Tipo" FROM (

    SELECT dictionaryContent FROM gtcDictionaryContent where dictionaryId = $dictionaryId

    EXCEPT

    SELECT distinct content
    FROM
    (
        SELECT substring(subTag, 0, position('.' in subTag)) as field,
            substring(subTag, position('.' in subTag)+1) as subfield
        FROM regexp_split_to_table( (
                    SELECT tags
                    FROM gtcDictionary where dictionaryid =$dictionaryId ) , ',' ) AS subTag )
            AS tags
    INNER JOIN gtcMaterial M ON (tags.field = M.fieldid AND tags.subfield = M.subfieldID )

    ) as sobrando
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>40</reportid>
        <title>Lista ordenada para inventário</title>
        <description><![CDATA[Este relatório lista todos os exemplares da unidade de biblioteca selecionada de forma ordenada para a realização do 
    inventário.

    <br><br>
    <b>Exemplos de preenchimento do campo "Classificação":</b> <br>
    <table align=center>
    <tr align=left>
    <td align=left>
    <b>51</b> - Pesquisa pela classificação <b>51</b>
    </td>
    </tr>
    <tr align=left>
    <td>
    <b>5%</b> - Pesquisa pelas classificações que <b>começam</b> com <b>5</b>
    </tr>
    </td>
    </table>

    <br>
    É necessário que o campo 090.a (Número de Classificação) na catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[                    SELECT MC.controlnumber as "Número de controle", 
                            M.content as "Chamada",
                            (SELECT content FROM gtcMaterial WHERE fieldid = '090' AND subfieldid = 'b' AND controlNumber = MC.controlNumber) as "Cutter",
                            EC.itemNumber as "Exemplar",
                            ES.description as "Estado do exemplar" 
                        FROM gtcMaterialControl MC
                    INNER JOIN gtcMaterial M ON (MC.controlnumber = M.controlnumber AND fieldId = '090' and subfieldid = 'a' AND ( content LIKE '$classification' ) ) --Filtro de classificação, um por vez, sem explode.
                    INNER JOIN gtcExemplaryControl EC ON (EC.controlnumber = MC.controlnumber) 
                    LEFT JOIN gtcExemplaryStatus ES ON (ES.exemplaryStatusID = EC.exemplaryStatusId)
                        WHERE EC.libraryUnitId = '$libraryUnitId' -- um filtro por unidade, ou seja, sem a opção "Todas" 
                    ORDER BY split_part(M.searchContent, '@', 1),
                            split_part(M.searchContent, '@', 2),
                            MC.controlnumber
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    <item>
        <reportid>MATERIAL_EVALUATION</reportid>
        <title>Avaliações de Material</title>
        <description><![CDATA[Este relatÃ³rio disponibiliza totais sobre quantidades, média e pontuações quanto a avaliações efetuadas por pesquisadores/usuáios/alunos. é importante considerar que todas avaliaçõees nulas ou zeradas são desconsideradas.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[   SELECT e.controlNumber as "Número de controle",
            m.content as Autor, t.content as "Título" ,
            count(evaluatioN) as "Quant." ,
            round(avg(evaluation),2) as "Média",
            count(evaluation) * sum(evaluation) as "Pontuação"
        FROM gtcmaterialevaluation e
    LEFT JOIN gtcMaterial m ON ( e.controlNumber = m.controlNumber and fieldid = '100' and subfieldid='a' )
    LEFT JOIN gtcMaterial t ON ( e.controlNumber = t.controlNumber and t.fieldid = '245' and t.subfieldid='a' )
        WHERE e.controlNumber in ( SELECT controlNumber FROM gtcExemplaryControl ex WHERE CASE WHEN $libraryUnitId::varchar = '0' THEN true ELSE libraryUNitId = $libraryUnitId END )
        AND ( evaluation > 0 or evaluation is not null )
    GROUP BY e.controlNumber , m.content, t.content
    ORDER BY $order $type
        LIMIT $limit;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>41</reportid>
        <title>Estatística - Gênero Material</title>
        <description><![CDATA[]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            A.materialgenderid as "Id", 
            B.description as "Descrição", 
            count(distinct controlnumber) as "Quantidade de obras",
            count(itemnumber) as "Quantidade Exemplares"

    FROM 
            gtcexemplarycontrol A 

    INNER JOIN 
            gtcmaterialgender B 
            ON 
                    (A.materialgenderid = B.materialgenderid) 

    WHERE (A.libraryUnitId = $libraryUnitId OR 0 = $libraryUnitId)

            Group by 1, 2;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>MULTAS_PERIODO</reportid>
        <title>Multas por período</title>
        <description><![CDATA[Retorna quantia das multas no período especificado.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[ SELECT
            loanid as "Código do empréstimo",
            fineid as "Código da multa",
            to_char(beginDate,'dd/mm/yyyy hh24:MI:SS') as "Data inicial",
            to_char(enddate,'dd/mm/yyyy hh24:MI:SS') as "Data final" ,
            libraryname as "Unidade",
            operador as "Operador",
            description as "Estado do empréstimo",
            value as "Valor"
        FROM
        (
            SELECT
                f.loanid,
                F.fineid,
                f.begindate,
                f.enddate ,
                U.libraryname,
                (SELECT operator FROM gtcfinestatushistory H WHERE H.fineid = F.fineid AND H.date = (SELECT max(date) from gtcfinestatushistory WHERE fineid = F.fineid) ) as "operador",
                s.description ,
                F.value ,
                F.finestatusid
            FROM     gtcfine as F
                INNER JOIN gtcfinestatus as S  ON F.finestatusid = S.finestatusid
                INNER JOIN gtcloan L  ON L.loanid = F.loanid
                INNER JOIN gtclibraryunit U  ON L.libraryunitid = U.libraryunitid

                AND CASE WHEN $unityId > 0
                THEN  L.libraryunitid = $unityId
                ELSE 1=1
                END
                AND CASE WHEN $status > 0
                THEN  F.finestatusid = $status
                ELSE 1=1
                END
        ) as AA

        WHERE

        endDate::date >= '$beginDate'::date
        AND endDate::date <= '$finalDate'::date
        AND CASE WHEN '$operator' = 'Todos' THEN  1=1
        ELSE operador = '$operator'
        END
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>ACTIVE_PERSON</reportid>
        <title>Pessoas ativas</title>
        <description><![CDATA[]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT A.personId as "Código",
            A.name as "Nome",
            C.description as "Vínculo",
            COALESCE(to_char(B.dateValidate, 'dd/mm/yyyy'),'Permanente') as "Data de validade"
        FROM basPerson A
    INNER JOIN basPersonLink B
            ON (A.personId = B.personid)
    INNER JOIN basLink C
            ON (B.linkId = C.linkId)
        WHERE (B.dateValidate >= now()::date OR B.dateValidate IS NULL)
        AND CASE WHEN $linkId = 0 THEN 1=1
        ELSE B.linkId = $linkId
        END
        ORDER BY A.name
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>PRS</reportgroup>
    </item>
    <item>
        <reportid>LOAN_BY_TYPE</reportid>
        <title>Quantidade de empréstimos por tipo</title>
        <description><![CDATA[Mostra quais os tipos de materiais mais emprestados em um determinado período em ordem decrescente de quantidade de empréstimos o campo. O campo tipo do material 949.a deve estar preenchido para que o material conste neste relatório.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT C.materialTypeId as "Código",
            C.description as "Tipo do material",
            count(*) as "Quantidade de empréstimos"
        FROM gtcLoan A
    INNER JOIN gtcExemplaryControl B
            ON (A.itemNumber = B.itemNumber)
    INNER JOIN gtcMaterialType C
            ON (B.materialTypeId = C.materialTypeId)
        WHERE A.loanDate between '$beginDate'::TIMESTAMP and '$finalDate'::TIMESTAMP
        AND CASE WHEN $materialTypeId = 0 THEN 1=1
            ELSE B.materialTypeId = $materialTypeId
            END
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
            ELSE B.libraryUnitId = $libraryUnitId
            END
    GROUP BY 1, 2
    ORDER BY 3 DESC;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>MOST_BORROWED</reportid>
        <title>Materiais mais retirados</title>
        <description><![CDATA[Exibe quais os materiais mais retirados da biblioteca mostrando número de controle, título e quantidade de empréstimos em ordem decrescente de quantidade de empréstimos. O campo tipo do material 949.a deve estar preenchido para que o material conste neste relatório.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT C.controlNumber as "Número de controle",
            C.content as Título,
            count(*) as "Quantidade de empréstimos"
        FROM gtcLoan A
    INNER JOIN gtcExemplaryControl B
            ON (A.itemNumber = B.itemNumber)
    INNER JOIN gtcMaterial C
            ON (B.controlNumber = C.controlNumber AND C.fieldId = '245' AND C.subfieldId = 'a')
        WHERE A.loanDate between '$beginDate'::timestamp and '$finalDate'::timestamp
        AND CASE WHEN $materialTypeId = 0 THEN 1=1
            ELSE B.materialTypeId = $materialTypeId
            END
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
            ELSE B.libraryUnitId = $libraryUnitId
            END
    GROUP BY 1, 2
    ORDER BY 3 DESC;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>LOAN_BY_ENTERPRISE</reportid>
        <title>Empréstimos por empresa</title>
        <description><![CDATA[Exibe quantidade de empréstimos por empresa em ordem decrescente.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT D.label as Empresa,
            count(*) as "Quantidade de empréstimos"
        FROM gtcLoan A
    INNER JOIN basPerson B
            ON (A.personId = B.personId)
    INNER JOIN gtcExemplaryControl C
            ON (C.itemNumber = A.itemNumber)
    LEFT JOIN basDomain D
            ON (D.domainid = 'PERSON_GROUP' AND key = B.personGroup)
        WHERE A.loanDate between '$beginDate'::TIMESTAMP and '$finalDate'::TIMESTAMP
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
            ELSE C.libraryUnitId = $libraryUnitId
            END
    GROUP BY 1
    ORDER BY 2 DESC;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>LOAN_BY_PERSON</reportid>
        <title>Empréstimos por pessoa</title>
        <description><![CDATA[Exibe quantidade de empréstimos por usuário em ordem decrescente por quantidade de empréstimo.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT B.personId as "Código",
            B.name as "Nome",
            count(*) as "Quantidade de empréstimos" 
        FROM gtcLoan A
    INNER JOIN basPerson B
            ON (A.personId = B.personId)
    INNER JOIN gtcExemplaryControl C
            ON (C.itemNumber = A.itemNumber)
        WHERE A.loanDate::date between '$beginDate'::date and '$finalDate'::date
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
            ELSE C.libraryUnitId = $libraryUnitId
            END
    GROUP BY 1, 2
    ORDER BY 3 DESC;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>MATERIAL_TYPE_STATIS</reportid>
        <title>Estatística - Tipo de material</title>
        <description><![CDATA[Exibe a quantidade de materiais e exemplares de um determinado tipo de material ordenando em ordem decrescente pela quantidade de materiais e exemplares. Para que o material conste neste relatório o campo 901.a deve estar preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT A.materialTypeId as "Id",
            A.description as "Tipo",
            (SELECT count(distinct A1.controlnumber) FROM gtcMaterialControl A1 LEFT JOIN gtcExemplaryControl B1 ON (A1.controlNumber = B1.controlNumber)  WHERE A1.materialTypeId = A.materialTypeId AND CASE WHEN $libraryUnitId = 0 THEN 1=1 ELSE libraryUnitId = $libraryUnitId END) as "Obras",
            (SELECT count(materialTypeId) FROM gtcExemplaryControl WHERE materialTypeId = A.materialTypeId AND CASE WHEN $libraryUnitId = 0 THEN 1=1 ELSE libraryUnitId = $libraryUnitId END) as "Exemplares"
        FROM gtcMaterialType A
        WHERE CASE WHEN $materialTypeId = 0 THEN 1=1
                    ELSE A.materialTypeId = $materialTypeId
                END
    order by 3 desc, 4 desc
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>INVENTARY</reportid>
        <title>Inventário</title>
        <description><![CDATA[Exibe todos os exemplares existentes dentro dos filtros de "Classificação" e "Unidade de biblioteca", estes sendo estes ordenados pelo campo "Ordenar por".

    Para que os exemplares constem neste relatório os seguintes campos devem ser preenchidos :

    <b>090.a, 100.a, 245.a</b>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT A.controlnumber as "Número de controle",
            A.content as "Classificação",
            D.content as "Título",
            E.content as "Autor",
            B.itemNumber as "Exemplar",
            B.exemplaryStatusId || ' - ' || C.description as "Estado"

        FROM gtcMaterial A
    INNER JOIN gtcExemplaryControl B
            ON (A.controlNumber = B.controlNumber)
    INNER JOIN gtcExemplaryStatus C
            ON (B.exemplaryStatusId = C.exemplaryStatusId)
    LEFT JOIN gtcMaterial D
            ON (A.controlNumber = D.controlNumber AND D.fieldid = '245' AND D.subfieldid = 'a')
    LEFT JOIN gtcMaterial E
            ON (A.controlNumber = E.controlNumber AND E.fieldid = '100' AND E.subfieldid = 'a')

    where A.fieldid = '090' and A.subfieldid = 'a'

    AND CASE WHEN $libraryUnitId = 0 THEN 1=1
            ELSE B.libraryUnitId = $libraryUnitId
        END
    AND split_part(A.searchcontent, '@', 1) between prepareSearchContent('090.a','$beginClassification','') AND prepareSearchContent('090.a','$finalClassification','')

    ORDER BY $orderBy.searchcontent;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>MOST_BORROWED_SUB</reportid>
        <title>Assuntos mais retirados.</title>
        <description><![CDATA[Exibe quais os assuntos dos materiais mais retirados em ordem decrescente de quantidade. Para que os empréstimos sejam contabilizados é necessário que o campo <b>650.a</b> seja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT C.content as Assunto,
            count(*) as "Quantidade de empréstimos"
        FROM gtcLoan A
    INNER JOIN gtcExemplaryControl B
            ON (A.itemNumber = B.itemNumber)
    INNER JOIN gtcMaterial C
            ON (B.controlNumber = C.controlNumber AND C.fieldId = '650' AND C.subfieldId = 'a')
        WHERE A.loanDate between '$beginDate' and '$endDate'
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
                    ELSE B.libraryUnitId = $libraryUnitId
            END
    GROUP BY 1
    ORDER BY 2 DESC;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>

    <item>
        <reportid>TOTAL_ACQUISITION</reportid>
        <title>Totalização de tipo de aquisição</title>
        <description><![CDATA[Este relatório lista a totalização de exemplares por tipos de aquisição por período e unidade. Utiliza o campo 949.c como referência, caso esse campo não seja preenchido o material não será contabilizado.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[    SELECT o.description as "Tipo de aquisição",
            count(controlNumber) as "Quantidade"
        FROM gtcexemplarycontrol e
    INNER JOIN gtcmarctaglistingoption o
            ON ( lower(e.acquisitiontype) = lower( o.option) and marctaglistingid = '949.c'  )
        AND entrancedate >= '$beginDate'
        AND entranceDate <= '$endDate' 
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1
                    ELSE libraryUnitId = $libraryUnitId
            END
    GROUP BY acquisitiontype, o.description
    ORDER BY 2 desc;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>LOAN_BY_ENT_SUB</reportid>
        <title>Empréstimos por empresa/assuntos</title>
        <description><![CDATA[Este relatório exibe a quantidade de empréstimos de materiais por assunto que uma empresa efetuou.
    Para que os materiais constem neste relatório o campo <b>650.a</b> deve estar preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[   SELECT B.personGroup as Empresa, 
            D.content as "Assunto", 
            count(*) as "Quantidade de empréstimos"
        FROM gtcLoan A 
    INNER JOIN basPerson B 
            ON (A.personId = B.personId) 
    INNER JOIN gtcExemplaryControl C 
            ON (C.itemNumber = A.itemNumber) 
    INNER JOIN gtcMaterial D
            ON (C.controlNumber = D.controlNumber AND D.fieldId = '650' AND D.subfieldId = 'a') 
    LEFT JOIN basDomain E
            ON (E.domainid = 'PERSON_GROUP' AND key = B.personGroup)
        WHERE A.loanDate between '$beginDate' and '$endDate' 
        AND CASE WHEN $libraryUnitId = 0 THEN 1=1 
                    ELSE C.libraryUnitId = $libraryUnitId 
            END 
        AND CASE WHEN '$personGroup' = '0' THEN 1=1 
                ELSE B.personGroup = '$personGroup' 
            END 
    GROUP BY 1, 2 
    ORDER BY 3 DESC; ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>
    <item>
        <reportid>TIPO_AQUISICAO_LISTA</reportid>
        <title>Lista de tipos de aquisição</title>
        <description><![CDATA[Lista os materiais pelo tipo de aquisição, para que o material seja contabilizado nesta listagem o campo <b>949.c</b> deste deve estar preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
                a.itemnumber as "Numero do tombo", 
                a.controlnumber as "Numero de controle", 
                b.content as "Título",
                c.content as "Autor",
                (SELECT description FROM gtcmarctaglistingoption WHERE marctaglistingid = '949.c' and option = a.acquisitiontype) as "Tipo de aquisição",
                to_char(a.entrancedate,'DD/MM/YYYY') as "Data de entrada"	
        FROM 
                gtcexemplarycontrol as a
            LEFT JOIN gtcmaterial as b ON (a.controlnumber = b.controlnumber AND b.fieldid = '245' AND b.subfieldid = 'a')
            LEFT JOIN gtcmaterial as c ON (a.controlnumber = c.controlnumber AND c.fieldid = '100' AND c.subfieldid = 'a')
        WHERE
                CASE WHEN '$aquisitionType' = '0' THEN 1=1
                ELSE a.acquisitiontype = '$aquisitionType'
                END
                AND CASE WHEN  '$libraryUnitId' = '0' THEN 1=1
                ELSE a.libraryunitid = '$libraryUnitId'
                END
                AND a.entrancedate >= '$beginDate'
                AND a.entrancedate <= '$finalDate'
ORDER BY 6]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>INSERIDO_PERIODO</reportid>
        <title>Lista de materiais inseridos por período</title>
        <description><![CDATA[Lista todos materiais inseridos dentro de um determinado período.
    Para que o material seja contabilizado corretamente será necessário o preenchimentos das etiquetas <b>950.a</b>,<b>90.a</b>,<b>245.a</b>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            (SELECT distinct(content) from gtcmaterial where fieldid = '950' and subfieldid = 'a' and controlnumber = E.controlnumber limit 1) as Obra,
            E.controlnumber as Controle,
            E.itemnumber as Exemplar,
            (SELECT content from gtcmaterial where fieldid = '245' and subfieldid = 'a' and controlnumber = E.controlnumber LIMIT 1) as Título,
            (SELECT description FROM gtcexemplarystatus where exemplarystatusid = E.exemplarystatusid)  as Estado,
            (SELECT distinct(content) from gtcmaterial where fieldid = '090' and subfieldid = 'a' and controlnumber = E.controlnumber limit 1) as Classificação
    FROM 
            gtcmaterialcontrol D 
            INNER JOIN gtcexemplarycontrol E ON (D.controlnumber = E.controlnumber) 

    WHERE  
            D.entrancedate::DATE BETWEEN '$beginDate' AND '$finalDate'
            AND CASE WHEN '$materialGenderId' = '-1' THEN 1=1
            ELSE E.materialgenderid = '$materialGenderId'
            END
            AND CASE WHEN '$libraryUnitId' = 0 THEN 1=1
            ELSE E.libraryunitid = '$libraryUnitId'
            END
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>LISTA_EXEMPLARES</reportid>
        <title>Lista de exemplares</title>
        <description><![CDATA[Este relatório lista exemplares da instituição por unidade de biblioteca, área de conhecimento, tipo físico do material, estado do exemplar e planilha.
    Para melhor visualização as etiquetas <b>245.a, 100.a, 901.b</b> devem estar preenchidas.
    Caso a planilha seja filtrada por SE.4, o autor não irá aparecer na listagem pois periódicos não tem autor.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        A.controlnumber AS "Número de controle", 
        A.itemnumber AS "Número de obra" ,
        b.content as "Título",
        c.content as "Autor",
        (E.category ||'.'|| E.level) as "Categoria",
        ES.description as "Estado do exemplar",
        MPT.description as "Tipo fisico do material",
        MTLO.description as "Área de conhecimento"
    FROM 
        gtcexemplarycontrol A LEFT JOIN gtcmaterial B ON (A.controlnumber = B.controlnumber AND B.fieldid = '245' AND B.subfieldid = 'a')
        LEFT JOIN gtcmaterial C ON (C.controlnumber = A.controlnumber AND C.fieldid = '100' AND C.subfieldid = 'a')
        LEFT JOIN gtcmaterial D ON (D.controlnumber = A.controlnumber AND D.fieldid = '901' AND D.subfieldid = 'b')
        LEFT JOIN gtcmaterialcontrol E ON (E.controlnumber = A.controlnumber)
        LEFT JOIN gtcmaterialphysicaltype MPT ON (MPT.materialphysicaltypeid = A.materialphysicaltypeid)
        LEFT JOIN gtcexemplarystatus ES ON (ES.exemplarystatusid =  A.exemplarystatusid)
        LEFT JOIN gtcmarctaglistingoption MTLO ON (MTLO.marctaglistingid = '901.b' AND MTLO.option = D.content)

    WHERE 
        -- Unidade de biblioteca   
        CASE WHEN '$libraryUnitId' = '0' 
        THEN '1'='1'
        ELSE A.libraryunitid = '$libraryUnitId'
        END
        -- Tipo fisico
        AND CASE WHEN '$materialPhysicalTypeId' = '0'
        THEN '1'='1'
        ELSE A.materialphysicaltypeid = '$materialPhysicalTypeId'
        END 
        -- Tipo do material (Livro ou Periodico)
        -- Planilha
        AND CASE WHEN '$spreadSheetId' = '0' 
        THEN '1'='1'
        ELSE (E.category ||'.'|| E.level) = '$spreadSheetId'
        END
        
        -- Estado do exemplar      
        AND CASE WHEN '$exemplaryStatusId' = (SELECT max(exemplarystatusid)+1 FROM gtcexemplarystatus)
        THEN '1'='1'
        ELSE A.exemplarystatusid = '$exemplaryStatusId'
        END

        -- Area de conhecimento
        AND CASE WHEN '$knowledgeAreaId' = '0' 
        THEN '1'='1'
        ELSE D.content = '$knowledgeAreaId' 
        END

    ORDER BY 1,2;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>OBRA_LISTA</reportid>
        <title>Lista de todas obras</title>
        <description><![CDATA[Lista todas obras por unidade e tipo de material.
    Para melhor visualização do relatório, as etiquetas abaixo devem estar preenchidas :
    <b>245.a,100.a,901.a</b>.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
        B.controlNumber as "Número de controle",
        titulo.content as "Título",
        autor.content as "Autor",
        A.libraryName as "Unidade de biblioteca",
        materialtype.description as "Tipo de material"
    FROM gtcLibraryUnit A
        LEFT JOIN gtcExemplaryControl B ON (A.libraryUnitId = B.originalLibraryUnitId)
        LEFT JOIN gtcmaterial titulo ON (B.controlnumber = titulo.controlnumber AND titulo.fieldid = '245' and titulo.subfieldid = 'a' )
        LEFT JOIN gtcmaterial autor ON (B.controlnumber = autor.controlnumber AND autor.fieldid = '100' and titulo.subfieldid = 'a' )          
        LEFT JOIN gtcmaterial tipo ON (B.controlnumber = tipo.controlnumber AND tipo.fieldid = '901' and tipo.subfieldid = 'a' )
        LEFT JOIN gtcmaterialtype materialtype ON (tipo.content = materialtype.materialtypeid::varchar)          
    WHERE 
        CASE WHEN '$libraryUnitId' = 0 THEN 1 = 1 ELSE B.libraryUnitId = '$libraryUnitId' END
        AND CASE WHEN '$materialTypeId' = 0 THEN 1 = 1 ELSE materialtype.materialtypeid = '$materialTypeId' END
    GROUP BY A.libraryname,B.controlnumber,titulo.content,autor.content,tipo.content,materialtype.description
    ORDER BY 1;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>CLASSE_ANO</reportid>
        <title>Lista de exemplares por ano e classificação</title>
        <description><![CDATA[Este relatório mostra todos os exemplares por <b>ano</b> e <b>classificação</b>.
    Só serão mostrados corretamente os materiais em que o campo <b>260.c</b> estiver preenchido com o ano corretamente, apenas com quatro dígitos.
    A classificação pode ser filtrada com o caractere <b>%</b>, isso significa que caso seja feito um filtro pela classificação <b>"2%"</b>, todos exemplares que tiverem a etiqueta <b>090.a</b> com o conteúdo que comece com <b>2</b> irão ser listados, caso queira filtrar por todas classificações preencha o campo <b>Classificação</b> com <b>%</b> apenas.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            A.controlnumber as "Número de controle",
            E.itemnumber as "Exemplar",
            B.content as "Autor",
            C.content as "Título",
            rpad(regexp_replace(A.content, '[^0-9]','', 'g'), 4, '0') as "Ano",
            D.content as "Classificação"
            
    FROM 
            gtcmaterial A 
            LEFT JOIN gtcmaterial B ON (B.controlnumber = A.controlnumber AND B.fieldid = '100' and B.subfieldid = 'a')
            LEFT JOIN gtcmaterial C ON (C.controlnumber = A.controlnumber AND C.fieldid = '245' and C.subfieldid = 'a')
            LEFT JOIN gtcmaterial D ON (D.controlnumber = A.controlnumber AND D.fieldid = '090' and D.subfieldid = 'a')
            LEFT JOIN gtcexemplarycontrol E ON (E.controlnumber = A.controlnumber)
    WHERE 
            A.fieldid = '260' 
            AND A.subfieldid = 'c' 
            AND length(regexp_replace(A.content, '[^0-9]','', 'g')) > 0
            
            AND CASE WHEN '$beginYear' = '0' THEN 1=1
            ELSE regexp_replace(A.content, '[^0-9]','', 'g')::int >= '$beginYear'
            END
            AND CASE WHEN '$finalYear' = '0' THEN 1=1
            ELSE regexp_replace(A.content, '[^0-9]','', 'g')::int <= '$finalYear'
            END
            
            AND CASE WHEN '$classification' = '%' THEN 1=1
            ELSE D.content like '$classification'
            END]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>EXEMPLAR_CNPQ</reportid>
        <title>Lista de exemplares por CNPQ</title>
        <description><![CDATA[Este relatório lista todos os exemplares ordenandos por CNPQ, número do tombo e número de controle.
    <br>
    Para que os exemplares dos materiais sejam listados neste relatório os campos abaixo devem estar preenchidos na catalogação :
    <ul>
    <li> 901.b - Área de conhecimento </li>
    <li> 245.a - Título </li>
    <li> 100.a - Autor </li>
    <li> 949.1 - Tipo do material </li>
    <li> 949.b - Unidade  </li>
    </ul>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[
        SELECT 
                A.controlnumber as "Número de controle",
                A.itemnumber as "Número do tombo",
                C.content as "Título",
                D.content as "Autor",
                (SELECT content FROM gtcmaterial WHERE controlnumber = A.controlnumber AND A.line = line AND fieldid = '090' and subfieldid = 'a') as "Classificação",
                (SELECT content FROM gtcmaterial WHERE controlnumber = A.controlnumber AND A.line = line AND fieldid = '090' and subfieldid = 'b') as "Cutter",
                A.entrancedate as "Data de entrada", 
                (SELECT description FROM gtcmarctaglistingoption WHERE marctaglistingid = '901.b' and option = B.content) as "Área de conhecimento",
                F.description as "Tipo do material",
                E.libraryname as "Unidade"

        FROM    gtcexemplarycontrol A 
                LEFT JOIN gtcmaterial B ON A.controlnumber = B.controlnumber 
                LEFT JOIN gtcmaterial C ON (A.controlnumber = C.controlnumber AND C.fieldid = '245' AND C.subfieldid = 'a')
                LEFT JOIN gtcmaterial D ON (A.controlnumber = D.controlnumber AND D.fieldid = '100' AND D.subfieldid = 'a')
                LEFT JOIN gtclibraryunit E ON A.libraryunitid = E.libraryunitid
                LEFT JOIN gtcmaterialtype F ON A.materialtypeid = F.materialtypeid 
        WHERE 
                B.fieldid = '901' 
                AND B.subfieldid = 'b' 
                AND CASE WHEN '$knowledgeAreaId' = '0' THEN 1=1 ELSE b.content = '$knowledgeAreaId' END     
                AND (A.entrancedate BETWEEN '$beginDate'::date AND '$endDate'::date OR A.entrancedate IS NULL)
                AND CASE WHEN $libraryUnitId = 0 THEN 1=1 ELSE A.libraryUnitId = $libraryUnitId END
                AND CASE WHEN $materialTypeId = 0 THEN 1=1 ELSE A.materialTypeId = $materialTypeId END             
        ORDER BY $orderBy;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>ESTATATISTA_CNPQ</reportid>
        <title>Estatí­stica - Exemplares por CNPQ</title>
        <description><![CDATA[Relatório que mostra a totalização de exemplares por área de conhecimento e unidade.
    <br>
    Para que os materiais e exemplares sejam incluídos corretamente neste relatório os campos abaixo devem estar cadastrados :
    <ul>
    <li>
    901.b - Área de conhecimento
    </li>
    <li>
    949.b - Código da unidade
    </li>
    </ul>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT  O.option as "Código",
            O.description as "Área de conhecimento",
            count(EX.itemnumber) as "Quantidade de exemplares",
            count(distinct(EX.controlnumber)) as "Quantidade de obras"

    FROM    gtcexemplarycontrol EX
            LEFT JOIN gtcmaterial M ON M.controlnumber = EX.controlnumber AND M.fieldid = '901' and M.subfieldid = 'b'
            LEFT JOIN gtcmarctaglistingoption O ON O.option = M.content AND marctaglistingid = '901.b'

    WHERE
            CASE WHEN $libraryUnitId = 0 THEN 1=1
                    ELSE EX.libraryUnitId = $libraryUnitId
            END
            
    GROUP by O.description,O.option 
    ORDER BY 1
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>
    <item>
        <reportid>ACCESS_FORM</reportid>
        <title>Formulários mais/menos acessados</title>
        <description><![CDATA[Lista os formulários mais ou menos acessados.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT menu as "Formulário", count(*) as "Acessos" FROM gtcAnalytics WHERE menu != '' AND action != 'main' GROUP BY menu ORDER BY 2 $orderby LIMIT $limit;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACS</reportgroup>
    </item>
    <item>
        <reportid>CAPA_DVD</reportid>
        <title>Capa de DVD</title>
        <description><![CDATA[Imprime capa de DVD]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[   SELECT e.itemNumber, 
            CASE WHEN m245b.content IS NULL THEN m245a.content ELSE m245a.content || ':' END as "245.a",
            m245b.content as "245.b",
            m090a.content as "090.a",
            m090b.content as "090.b"
        FROM gtcexemplarycontrol e
    LEFT JOIN gtcMaterial m245a 
        ON ( m245a.controlnumber = e.controlnumber and m245a.fieldid = '245' and m245a.subfieldid = 'a' )
    LEFT JOIN gtcMaterial m245b 
        ON ( m245b.controlnumber = e.controlnumber and m245b.fieldid = '245' and m245b.subfieldid = 'b' )
    LEFT JOIN gtcMaterial m090a
        ON ( m090a.controlnumber = e.controlnumber and m090a.fieldid = '090' and m090a.subfieldid = 'a' )
    LEFT JOIN gtcMaterial m090b
        ON ( m090b.controlnumber = e.controlnumber and m090b.fieldid = '090' and m090b.subfieldid = 'b' )
        WHERE materialphysicaltypeid = 3 and e.itemNumber IN ($itemNumber);
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>IMP</reportgroup>
    </item>
    <item>
        <reportid>CAPA_CD</reportid>
        <title>Capa de CD</title>
        <description><![CDATA[Imprime capas de CD. Somente os materias com tipo físico CD são aceitos.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT e.itemNumber, m245a.content as "245.a", m949a.content as "949.a", m090a.content as "090.a", m090b.content as "090.b", m950a.content as "950.a"
    FROM gtcexemplarycontrol e
    LEFT JOIN gtcMaterial m245a ON ( m245a.controlnumber = e.controlnumber and m245a.fieldid = '245' and m245a.subfieldid = 'a' )
    LEFT JOIN gtcMaterial m949a ON ( m949a.controlnumber = e.controlnumber and m949a.fieldid = '949' and m949a.subfieldid = 'a' )
    LEFT JOIN gtcMaterial m090a ON ( m090a.controlnumber = e.controlnumber and m090a.fieldid = '090' and m090a.subfieldid = 'a' )
    LEFT JOIN gtcMaterial m090b ON ( m090b.controlnumber = e.controlnumber and m090b.fieldid = '090' and m090b.subfieldid = 'b' )
    LEFT JOIN gtcMaterial m950a ON ( m950a.controlnumber = e.controlnumber and m950a.fieldid = '950' and m950a.subfieldid = 'a' )
    WHERE materialphysicaltypeid = 2 and e.itemNumber IN ($itemNumber);
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>IMP</reportgroup>
    </item>
    <item>
        <reportid>SIMPLE_SEARCH_TEM</reportid>
        <title>Conteúdo pesquisado</title>
        <description><![CDATA[Lista os conteúdos pesquisados na pesquisa simples/avançada entre outros.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT CASE WHEN campo != '' THEN campo ELSE action END as campo, termo, quantidade
    FROM (     SELECT trim( ( SELECT array_to_string(array_agg(description),' e ')
                FROM ( SELECT trim( regexp_split_to_table( action, E'\and') ) AS searchField  ) AS S
            LEFT JOIN gtcsearchablefield
                    ON ( s.searchField = gtcsearchablefield .field) ) ,action ) AS
                    campo , action, event as Termo ,count(*) as Quantidade
        FROM gtcanalytics
        WHERE accesstype = 3
    GROUP BY 1,2,3
    ORDER BY 3 desc
        LIMIT $limit ) as foo;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACS</reportgroup>
    </item>
    <item>
        <reportid>CART_BIBLIOTECA</reportid>
        <title>Carteirinha da biblioteca</title>
        <description><![CDATA[Carteirinha da biblioteca]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT personId as "personId", 
        name as "name", 
        L.description as "link", 
        COALESCE(dateValidate::varchar, 'Permanente') as "validate", 
        'person/' || personId || '.' as "image", 
        personId as "codebar" 
    FROM ( SELECT P.personId,
                P.name,
                min( L.level),
                L.linkid as activelink,
                login,
                PL.dateValidate
            FROM basPerson P 
        INNER JOIN basPersonLink PL
                ON P.personId = PL.personId 
        INNER JOIN basLink L
                ON L.linkId = PL.linkId AND (PL.dateValidate >= now()::date OR PL.dateValidate IS NULL)
        GROUP BY 1,2,4,5,6 ORDER BY 1) as temp 
    LEFT JOIN basLink L 
        ON activelink = L.linkId 
        WHERE CASE WHEN '$interval' = 'D' 
            THEN 
                CASE WHEN ($personId) IS NULL 
                    THEN 1 = 1 
                ELSE 
                    personId IN ($personId) 
                END 
            ELSE 
                CASE WHEN ($beginPersonId IS NOT NULL) AND ($endPersonId IS NOT NULL) 
                THEN 
                    (personId BETWEEN $beginPersonId AND $endPersonId) 
                ELSE 
                    1 = 1 
                END 
            END 
            AND CASE WHEN $linkId IS NOT NULL 
            THEN 
                linkId = $linkId 
            ELSE 
                1 = 1 
            END]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[$MIOLO->GetClass('gnuteca3', 'codabar');
    class FrmCustomReport extends FrmAdminReport
    {
        public function createFields() 
        { 
            $data = $this->getReportData( );
        
        //Descrição do relatório a ser mostrada no topo da tela 
        if ($data->description) 
        { 
            $fields[] = new MDiv('divDescription', $data->description, 'reportDescription');
        } 
        
            $opts = array();
            $opts[] = array(_M('Contínuo', $this->module), 'C');
            $opts[] = array(_M('Discreto', $this->module), 'D');
            $fields[] = $interval = new GRadioButtonGroup('interval', _M('Tipo de intervalo', $this->module), $opts, 'D', null, MFormControl::LAYOUT_HORIZONTAL);
            $interval->addAttribute('onchange', "if ( dojo.byId('interval_0').checked ) { dojo.byId('continuouContent').style.display = 'block'; dojo.byId('discretContent').style.display = 'none'; dojo.byId('personId').value = ''; dojo.byId('linkId').value = ''; } else { dojo.byId('continuouContent').style.display = 'none'; dojo.byId('discretContent').style.display = 'block'; dojo.byId('beginPersonId').value = ''; dojo.byId('endPersonId').value = ''; dojo.byId('beginLinkId').value = ''; dojo.byId('endLinkId').value = ''; }");
            $personLabel = new MLabel(_M('Código do aluno') . ':');
            $linkLabel = new MLabel(_M('Código do vínculo') . ':');
            
            //intervalo discreto 
            $person = new MTextField('personId', null, null, FIELD_DESCRIPTION_SIZE );
            $personHint = new MDiv('hintPersonD', _M('Separar os códigos por vírgula. Ex: 505052, 505053, ...', $this->module));
            $personHint->setClass('mSpan mHint');
            $person = new GContainer('personC', array($personLabel, $person, $personHint));
            $fields[] = new MVContainer('discretContent', array($person));
            
            //intervalo contínuo 
            $beginPerson = new MTextField('beginPersonId', null, null, 10);
            $endPerson = new MTextField('endPersonId', null, null, 10);
            $personHint = new MDiv('hintPersonD', _M('Adicionar código inicial e código final', $this->module));
            $personHint->setClass('mSpan mHint');
            $person = new GContainer('personCont', array($personLabel, $beginPerson, $endPerson, $personHint));
            $fields[] = $continuous = new MVContainer('continuouContent', array($person));
            $continuous->addStyle('display', 'none');
            $busBond = $this->MIOLO->getBusiness('gnuteca3', 'BusBond');
            $fields[] = new GSelection('linkId', '', _M('Código do grupo de usuário', $this->module), $busBond->listBond(true));
            $this->setFields( $fields );
            $this->setValidators($valids);
            //ler dados do formulário $form = 'frmadminreport'.MIOLO::_REQUEST('reportId');
            $this->className = $form;
            $this->busFormContent->loadFormValues( $this );

            //forma padrão 
            $formContent = $this->busFormContent->loadFormValues( $this, true );

            //obter coluna total 
            if ( $formContent['total'] ) 
            {
                $totalField = $this->GetField('total');
                
                if ( $totalField )
                {
                    $totalField->setChecked( true );
                } 
            } 
        } 
        
        /** 
        * Seta o conteúdo no segmeto "content"
        * @param Segment $content objeto do segmento 
        * @param array $result resultado 
        * @param array $columns colunas do arquivo 
        */ 
        protected function setOdtContent(Segment $content, $result, $columns) 
        { 
            //defini dados para multiplicação de seguimentos 
            if ( is_array($result) && is_array( $columns ) ) 
            { 
                foreach ( $result as $line => $info )
                {
                    foreach ( $columns as $l => $column )
                    {
                        try 
                        {
                            if ( $column == 'image' ) //foto da pessoa 
                            {
                                $parts = explode('/', $info[$l]); //separa o arquivo do diretório 
                                $busFile = $this->MIOLO->getBusiness('gnuteca3','BusFile');
                                $busFile->folder= $parts[0]; //seta o diretório 
                                $busFile->fileName = $parts[1]; //seta o arquivo
                                $pathFile = $busFile->searchFile(true); //procura imagem default caso não tenha encotrado a imagem 
                            
                                if ( count($pathFile) == 0 )
                                {
                                    $busFile->fileName = 'default.';
                                    $pathFile = $busFile->searchFile(true);
                                } 
                                
                                $pathFile = $pathFile[0]->absolute;  //obtém caminho absoluto da imagem 
                                $content->setImage('image', $pathFile, 60, 75); //seta a imagem 3x4 
                            } 
                            else if ( $column == 'codebar' ) //código de barras 
                            { 
                                $tmpPath = BusinessGnuteca3BusFile::getAbsoluteFilePath('tmp', 'codabar_' . $info[$l], 'png' ); //obtém o path completo para arquivo 
                                $barcode = new codabar( $info[$l] ); //gera o código de barras do código de aluno 
                                $barcode->output(0.04, 1.27, 2, $tmpPath); //faz output para o tmp do Gnuteca 
                                $content->setImage('barcode', $tmpPath, 140, 30);
                                //seta código de barras 
                            } 
                            else 
                            { 
                                $content->$column( utf8_decode( $info[$l] ) );
                            } 
                        } 
                        catch (Exception $exc) 
                        { 
                            //caso o parametro não exista no content 
                        } 
                    } 
                    
                    $content->merge();
                } 
            } 
        } 
        
        /** 
        * Método reescrito para tratar dados do formulário 
        */ 
        
        public function getData() 
        { 
            $data = parent::getData();
            $data->personId = $data->personId ? $data->personId : 'null';
            $data->beginPersonId = $data->beginPersonId ? $data->beginPersonId : 'null';
            $data->endPersonId = $data->endPersonId ? $data->endPersonId : 'null';
            $data->linkId = $data->linkId ? $data->linkId : 'null';
            $data->beginLinkId = $data->beginLinkId ? $data->beginLinkId : 'null';
            $data->endLinkId = $data->endLinkId ? $data->endLinkId : 'null';

            return $data;
        } 
    }]]></script>
        <isactive>true</isactive>
        <reportgroup>IMP</reportgroup>
    </item>

    <item>
        <reportid>39</reportid>
        <title>Lista de Material por classificação</title>
        <description><![CDATA[Este relatório mostra todos os materiais de uma determinada área de conhecimento escolhida pela sua classificação, resultando em uma listagem de materiais com suas respectivas quantidades de exemplares.
    <br><br>
    <b>Exemplos de preenchimento do campo "Classificação":</b> <br>
    <table align=center>
    <tr align=left>
    <td align=left>
    <b>51</b> - Pesquisa pela classificação <b>51</b>
    </td>
    </tr>
    <tr align=left>
    <td>
    <b>52,63</b> - Pesquisa pelas classificações <b>52</b> e <b>63</b>
    </tr>
    </td>
    <tr align=left>
    <td>
    <b>5%</b> - Pesquisa pelas classificações que <b>começam</b> com <b>5</b>
    </tr>
    </td>
    <tr align=left>
    <td>
    <b>5%,7%</b> - Pesquisa pelas classificações que <b>começam</b> com <b>5</b> e <b>7</b>
    </tr>
    </td>
    </table>

    <br>
    É necessário que o campo 090.a (Número de Classificação) na catalogação esteja preenchido.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[
    class FrmCustomReport extends FrmAdminReport 
    { 
        private $busGenericSearch, $busSearchFormat;

        function __construct() 
        { 
            parent::__construct(); 
        }

        public function getReportData()
        { 
            $data = parent::getReportData();
            $args = (object) ( $_REQUEST ); 

$classificacoes = explode(",",$args->classificacao);

            $filtroClassificacao = " AND (content LIKE '". implode("' OR content LIKE '",$classificacoes)."')";


            $where = "";
            if ( $args->dataInicial )
            {
                $where .= " AND MC.entranceDate >= '{$args->dataInicial}' ";
            }
            if ( $args->dataFinal )
            {
                $where .= " AND MC.entranceDate <= '{$args->dataFinal}' ";
            }
            if( $args->libraryUnitId > 0 )
            {
                $where .= " AND EC.libraryUnitId = '{$args->libraryUnitId}'"; 
            }

            if ( $where )
            {
                $where = " WHERE ". substr($where,4,strlen($where));
            }
            
            $ordem = $args->ordem;
            if ( $ordem != '2' )
            {
                $ordenacao = " ORDER BY $ordem";
            }
            else
            {
                $ordenacao = " ORDER BY split_part(M.content, '@', 1),
                                        split_part(M.content, '@', 2) ";
            }

            $sql = "    SELECT MC.controlnumber as \"Número de Controle\", 
                            M.content as \"Classificação\",
                            (SELECT content FROM gtcMaterial WHERE fieldid = '245' AND subfieldid = 'a' AND controlNumber = MC.controlNumber) as \"Título\",
                            (SELECT content FROM gtcMaterial WHERE fieldid = '100' AND subfieldid = 'a' AND controlNumber = MC.controlNumber) as \"Autor\", 
                            count(EC.itemNumber) as \"Quantidade de exemplares\"
                        FROM gtcmaterialcontrol MC
                    INNER JOIN gtcmaterial M ON (MC.controlnumber = M.controlnumber AND fieldId = '090' and subfieldid = 'a' $filtroClassificacao )
                    INNER JOIN gtcexemplarycontrol EC ON (EC.controlnumber = MC.controlnumber) 

                            $where
                    GROUP BY 1,2 
                    {$ordenacao}"; 

            $data->reportSql = $sql;

            return $data;
        }
    }]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    <item>
        <reportid>NEXT_ITEMNUMBER</reportid>
        <title>Próximo número de exemplar/tombo.</title>
        <description><![CDATA[Obtém o próximo número de exemplar/tombo, este relatório é utilizado dentro da catalogação, modificando ele, a catalogação preencherá os dados de forma diferenciada.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[--Sugere o número do tombo. Pega o último e soma 1. Isso pode duplicar números caso exista mais de um catalogador
    --Sugere o número do tombo. Pega o último e soma 1. Isso pode duplicar números caso exista mais de um catalogador
    --SELECT lpad( (max(myItemNumber::bigint)+1)::varchar,8,'0') as itemNumber  FROM ( SELECT regexp_replace( upper(itemnumber),'.*[A-z]','') as myItemNumber FROM gtcexemplarycontrol WHERE itemNumber <> '' AND itemNumber is not null ) AS f WHERE ascii(myItemNumber) <> 0 ORDER BY  1 DESC;

    --Busca o número por sequência. Isso garante que nenhum usuário irá utilizar o mesmo código
    CREATE OR REPLACE FUNCTION fnc_nextItemNumber ( libraryUnitId gtcLibraryUnit.libraryUnitId%TYPE )
    RETURNS bigint AS $$
    DECLARE
        codigo bigint;
        v_query varchar;
        ultimo_codigo bigint;
    BEGIN
        SELECT INTO ultimo_codigo CASE WHEN max(trim(myItemNumber)::bigint) IS NULL THEN 1 ELSE max(trim(myItemNumber)::bigint) END  as itemNumber  FROM ( SELECT replace( replace( replace( regexp_replace( trim(upper(itemnumber)),'.*[A-z]','' ) ,'.',''),' ', '') ,'/','')  as myItemNumber FROM gtcexemplarycontrol WHERE itemNumber <> '' AND  itemNumber is not null ) AS f WHERE ascii(myItemNumber) <> 0 ORDER BY 1 DESC;
        -- Verifica se existe sequencia e pega o nextval, caso nao exista ainda, cria
        BEGIN
            codigo := nextval('seq_rptItemNumber');
        EXCEPTION
            WHEN OTHERS THEN
                -- cai no erro se a sequencia ainda nao existir
                v_query := 'CREATE SEQUENCE seq_rptItemNumber START ' || ultimo_codigo ;
                EXECUTE v_query;
                codigo := nextval('seq_rptItemNumber');
        END;

        IF (ultimo_codigo > codigo) THEN
            PERFORM setval('seq_rptItemNumber', ultimo_codigo);
            codigo := nextval('seq_rptItemNumber');
        END IF;

        RETURN codigo;
    END;
    $$ language 'plpgsql';

    SELECT lpad(fnc_nextItemNumber($libraryUnitId)::varchar,8,'0');
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>MAT</reportgroup>
    </item>
    
    <item>
        <reportid>EST_AQUISICAO</reportid>
        <title>Estatística - Exemplares por tipo de aquisição.</title>
        <description><![CDATA[Contabiliza quantos exemplares de cada tipo de aquisição foram inseridos no sistema em um determinado período.

        Para que o exemplar conste corretamente neste relatório os seguintes campos devem estar preenchidos :

        <ul>
        <li>
        949.y - Data de entrada
        </li>
        <li>
        949.c - Tipo de aquisição
        </li>
        <li>
        901.b - Tipo de aquisição
        </li>
        </ul>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
            (SELECT description FROM gtcmarctaglistingoption WHERE marctaglistingid = '949.c' AND option = EC.acquisitiontype) as "Descrição",
                (SELECT description FROM gtcmaterialtype WHERE materialtypeid = EC.materialtypeid) as "Tipo de material",
            COUNT(EC.*) AS "Quantidade"	
        FROM 
            gtcexemplarycontrol EC
        WHERE 
            EC.entrancedate::date BETWEEN '$beginDate' AND '$finalDate'
                AND CASE WHEN '$exceptAquisition' = '0' THEN 1=1
                ELSE EC.acquisitiontype IN (SELECT option FROM gtcmarctaglistingoption WHERE marctaglistingid = '949.c' AND option != '$exceptAquisition' ) 
                END
                AND CASE WHEN '$libraryUnitId' = '0' THEN 1=1
                ELSE EC.libraryunitid = '$libraryUnitId'
                END

                AND CASE WHEN '$materialTypeId' = '0' THEN 1=1
                ELSE EC.materialTypeId = '$materialTypeId'
                END
        GROUP BY 1,2
        ORDER BY 1,2]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item> 
    <item>
        <description><![CDATA[
<b>
Relatório genérico de materiais.
</b>
<br/>
<br/>
É possível descobrir a quantidade de obras e exemplares de acordo com algum filtro.
<br/>
<br/>
Este relatório vem de encontro a necessidade de simular os relatórios genéricos de material encontrados no sistema Gnuteca2.
<br/>
<br/>
O campo de filtro conteúdo utiliza uma busca simplifica, diferente da encontrada na pesquisa simples. Caso precise utilizar TERMO EXATO somente preencha o campo conteúdo, caso exista necessidade de uma pesquisa mais geral é possível utilizar o caracter coringa % em qualquer local do termo.
<br/>
<br/>
<b>
EX.
Termo exato: machado
<br/>
Inicia com machado: machado%
<br/>
Termina com machado %machado
<br/>
Qualquer conteúdo que tiver machado: %machado%
<br/>
Qualquer coisa que iniciar com ma e terminar com ado: %ma%ado%
</b>
]]>

</description>
        <title>Quantidade de obras e exemplares genérico</title>
        <isactive>t</isactive>
        <permission>basic</permission>
        <reportgroup>ACV</reportgroup>
        <reportid>MATERIAL_GENERIC</reportid>
        <reportsql><![CDATA[
CREATE TEMP TABLE tmpObrasExemplares 
                    (conteudo,
                    unidade,
                    obras,
                    exemplares)
               AS   select b.content  || coalesce( ( SELECT ' - ' || description
                                                       FROM gtcmarctaglistingoption
                                                      WHERE marctaglistingid = '$fieldid.$subfieldid'
                                                        AND option = b.content),'' ),
                    a.libraryUnitId || ' - ' || l.libraryName,
                    count( distinct a.controlNumber ),
                    count( distinct a.itemNumber )
             FROM   gtcExemplaryControl a,
                    gtcMaterial b,
                    gtcLibraryUnit l
            WHERE a.controlNumber = b.controlNumber
              AND ( l.libraryUnitId = a.libraryUnitId )
              AND b.fieldId = '$fieldid'
              AND b.subfieldId = '$subfieldid'
              AND b.searchcontent like preparesearchcontent('$fieldid.$subfieldid', '$content','')
              AND CASE WHEN $libraryUnitId = 0 THEN 1=1 ELSE a.libraryUnitId = $libraryUnitId END
         GROUP BY b.content,a.libraryUnitId,l.libraryName;

SELECT *
  FROM tmpObrasExemplares;
]]>
</reportsql>
        <reportsubsql></reportsubsql>
        <script></script>
    </item>
    <item>
        <reportid>SIMPLE_INVENTARY</reportid>
        <title>Inventário simplificado</title>
        <description><![CDATA[Exibe todos os exemplares existentes dentro dos filtros de "Classificação" e "Unidade de biblioteca", estes sendo estes ordenados pelo campo "Ordenar por".
    Para que os exemplares constem neste relatório os seguintes campos devem ser preenchidos :
    <b>090.a, 100.a, 245.a</b>]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[CREATE TEMP SEQUENCE seq_rel START 1;

CREATE TEMP TABLE inventario_simples AS (
    SELECT 
        nextval('seq_rel') as ordem,
	CASE WHEN trim(tag100a.content) NOTNULL THEN (coalesce(trim(tag100a.content),'') || '. ') ELSE (' ') END
	|| coalesce(trim(tag245a.content),'') 
	|| CASE WHEN trim(tag245b.content) NOTNULL THEN (': ' || coalesce(trim(tag245b.content),'') || '.') ELSE ('. ') END
	|| CASE WHEN trim(tag250a.content) NOTNULL THEN (coalesce(trim(tag250a.content || ' ' || ( SELECT content FROM gtcprefixsuffix WHERE prefixsuffixid = tag250a.suffixid ) ),'')  || ' ') ELSE (' ') END
	|| CASE WHEN trim(tag250b.content) NOTNULL THEN (coalesce(trim(tag250b.content) ,'') || '. ') ELSE (' ') END
	|| CASE WHEN trim(tag260a.content) NOTNULL THEN (coalesce(trim(tag260a.content),'') || '.') ELSE (' ') END
	|| CASE WHEN trim(tag260b.content) NOTNULL THEN (': ' || coalesce(trim(tag260b.content),'') || '.') ELSE ('. ') END
	|| CASE WHEN trim(tag260c.content) NOTNULL THEN (', ' || coalesce(trim(tag260c.content),'') || '.') ELSE (' ') END || '|'
        || CASE WHEN trim(tag949v.content) NOTNULL THEN (' ' || coalesce(trim(tag949v.content),'') || ' - ') ELSE (' ') END 
	|| coalesce(count(exControl.itemNumber),'0') || ' ex.'
	|| CASE WHEN trim(tag090a.content) NOTNULL THEN ('| ' ||coalesce(trim(tag090a.content),'') || ' ') ELSE (' ') END
	|| CASE WHEN trim(tag090b.content) NOTNULL THEN ('| ' ||coalesce(trim(tag090b.content),'') || ' ') ELSE (' ') END as inventario
,  coalesce(count(exControl.itemNumber),'0') as exemplares
FROM 	gtcMaterial tag090a
	INNER JOIN 
	gtcExemplaryControl exControl ON (tag090a.controlNumber = exControl.controlNumber)
	INNER JOIN 
	gtcMaterialControl materialControl ON (tag090a.controlNumber = materialControl.controlNumber)
	LEFT JOIN 
	(SELECT controlnumber,content,line FROM gtcmaterial WHERE fieldid = '949' and subfieldid = 'v') as tag949v ON tag949v.controlnumber = exControl.controlnumber AND tag949v.line = exControl.line
	LEFT JOIN
	gtcmaterial tag100a ON tag100a.controlnumber = tag090a.controlnumber AND tag100a.fieldid = '100' and tag100a.subfieldid = 'a'
	LEFT JOIN
	gtcmaterial tag245a ON tag245a.controlnumber = tag090a.controlnumber AND tag245a.fieldid = '245' and tag245a.subfieldid = 'a'
	LEFT JOIN
	gtcmaterial tag245b ON tag245b.controlnumber = tag090a.controlnumber AND tag245b.fieldid = '245' and tag245b.subfieldid = 'b'	
	LEFT JOIN
	gtcmaterial tag250a ON tag250a.controlnumber = tag090a.controlnumber AND tag250a.fieldid = '250' and tag250a.subfieldid = 'a'
	LEFT JOIN
	gtcmaterial tag250b ON tag250b.controlnumber = tag090a.controlnumber AND tag250b.fieldid = '250' and tag250b.subfieldid = 'b'	
	LEFT JOIN
	gtcmaterial tag260a ON tag260a.controlnumber = tag090a.controlnumber AND tag260a.fieldid = '260' and tag260a.subfieldid = 'a'		
	LEFT JOIN
	gtcmaterial tag260b ON tag260b.controlnumber = tag090a.controlnumber AND tag260b.fieldid = '260' and tag260b.subfieldid = 'b'
	LEFT JOIN
	gtcmaterial tag260c ON tag260c.controlnumber = tag090a.controlnumber AND tag260c.fieldid = '260' and tag260c.subfieldid = 'c'		
	LEFT JOIN
	gtcmaterial tag090b ON tag090b.controlnumber = tag090a.controlnumber AND tag090b.fieldid = '090' and tag090b.subfieldid = 'b'			
WHERE 
	tag090a.fieldid = '090' and tag090a.subfieldid = 'a'
	
	AND CASE WHEN  $libraryUnitId = 0 THEN 1=1
	    ELSE exControl.libraryUnitId = $libraryUnitId
	END
	AND CASE WHEN  $materialTypeId = 0 THEN 1=1
	    ELSE materialControl.materialTypeId = $materialTypeId
	END
	AND split_part(tag090a.searchcontentforsearchmodule, '@', 1) BETWEEN
            split_part(prepareSearchContentForSearchModule('090.a','$beginClassification',''), '@', 1) AND 
            split_part(prepareSearchContentForSearchModule('090.a','$finalClassification',''), '@', 1)
GROUP BY
	tag090a.controlnumber,
	tag090a.content,
	tag090a.searchcontent,
	tag090b.content,
	tag949v.content,
	tag100a.content,
	tag100a.searchcontent,
	tag245a.content,
	tag245a.searchcontent,
	tag245b.content,
	tag250a.content,
	tag250a.suffixid,
	tag250b.content,
	tag260a.content,
	tag260b.content,
	tag260c.content,
	tag090b.content
ORDER BY $orderBy.searchcontent);

CREATE temp table inventario_simples_com_ordem AS
(
(select * from inventario_simples)
UNION
(select (SELECT  nextval('seq_rel') as ordem), 'Total de obras: ', count(*) FROM inventario_simples)
UNION
(select (SELECT  nextval('seq_rel') as ordem), 'Total de exemplares: ', SUM(exemplares) FROM inventario_simples));

select inventario as "Inventário", exemplares as "Exemplares" from inventario_simples_com_ordem order by ordem;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACV</reportgroup>
    </item>    
    <item>
        <reportid>PERSON_ENTRY</reportid>
        <title>Pessoas inseridas por período.</title>
        <description><![CDATA[ Relatório de todos os usuários que foram inseridos no sistema. Em um determinado período.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT CASE WHEN L.description IS NULL THEN 'Sem vínculo' ELSE L.description END as "Vínculo", count(distinct(P.personid)) as "Quantidade" FROM 
        basperson P 
        LEFT JOIN baspersonlink PL ON P.personid = PL.personid
        LEFT JOIN baslink L ON PL.linkid = L.linkid
        WHERE P.dateIn BETWEEN '$beginDate' AND '$endDate'

        GROUP BY L.description;]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>PRS</reportgroup>
    </item>
    <item>
        <reportid>DIFERENCAS_RELATORIO</reportid>
        <title>Relatórios com alterações</title>
        <description><![CDATA[
Lista de relatórios que foram modificados após atualização.
A lista gerada indica que relatórios padrões do sistema estão sendo modificados. 
Contate o administrador do sistema para mais informações de como proceder quando um relatório deve ser alterado.
]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[
SELECT A.reportid as "Código do relatório", A.title as "Título", B.reportsql as "Relatório antigo", A.reportsql as "Relatório novo" FROM gtcreport A INNER JOIN gtcreport_old B USING (reportid) WHERE A.reportsql <> B.reportsql;
]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>ACS</reportgroup>
    </item>
     <item>
        <reportid>RETURN_REGISTER_PER</reportid>
        <title>Relatório de devolução</title>
        <description><![CDATA[Relatório de devoluções. Utilizando filtros por data e por operador.]]></description>
        <permission>basic</permission>
        <reportsql><![CDATA[SELECT 
    A.loanid as "Código",
    A.personId as "Pessoa",
    B.name as "Nome",
    A.itemNumber as "Número Exemplar",
    COALESCE((SELECT DISTINCT (content) FROM gtcmaterial WHERE fieldid='245' AND subfieldid='a'  AND controlnumber = C.controlnumber LIMIT 1), '-') as "Título",
    COALESCE((SELECT DISTINCT (content) FROM gtcmaterial WHERE fieldid='090' AND subfieldid='a'  AND controlnumber = C.controlnumber LIMIT 1) || ' ' || (SELECT DISTINCT (content) FROM gtcmaterial WHERE fieldid='090' AND subfieldid='b'  AND controlnumber = C.controlnumber LIMIT 1), '-') as "Classificação",
    A.loanDate as "Data de Empréstimo",
    A.returnforecastdate as "Data prevista de devolução",
    A.returndate as "Data devolução",
    A.returnoperator as "Operador da devolução"
    
FROM gtcLoan as A
INNER JOIN ONLY basperson as B
        ON (A.personId = B.personId)
INNER JOIN gtcexemplarycontrol as C
        ON (A.itemNumber = C.itemNumber)

WHERE
    A.returndate BETWEEN '$beginDate' AND '$endDate'
    AND

        CASE WHEN '$operator' = 'todos'
            THEN 1 = 1
            ELSE A.returnoperator = '$operator'
        END;
    ]]></reportsql>
        <reportsubsql><![CDATA[]]></reportsubsql>
        <script><![CDATA[]]></script>
        <isactive>true</isactive>
        <reportgroup>EMP</reportgroup>
    </item>    
</gtcreport>
